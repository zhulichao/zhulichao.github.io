<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="前端学习之路" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="前端学习之路">
<meta property="og:type" content="website">
<meta property="og:title" content="前端学习之路">
<meta property="og:url" content="https://zhulichao.github.io/page/12/index.html">
<meta property="og:site_name" content="前端学习之路">
<meta property="og:description" content="前端学习之路">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端学习之路">
<meta name="twitter:description" content="前端学习之路">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>

  <title> 前端学习之路 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?41d77ee7657d4e19a7f8a6361fe2121f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">前端学习之路</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      

  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
  
</nav>

 </div>
      
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/me.png"
               alt="小朱" />
          <p class="site-author-name" itemprop="name">小朱</p>
          <p class="site-description motion-element" itemprop="description">前端学习之路</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">168</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhulichao" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jikexueyuan.com/" title="极客学院" target="_blank">极客学院</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://caniuse.com" title="caniuse" target="_blank">caniuse</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://codepen.io" title="codepen" target="_blank">codepen</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://jsbin.com/?html,css,output" title="JS Bin" target="_blank">JS Bin</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://babeljs.io/repl/" title="Babel在线编译" target="_blank">Babel在线编译</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.iconfinder.com/iconsets/miu" title="Iconfinder图标" target="_blank">Iconfinder图标</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.bejson.com/" title="在线JSON格式化" target="_blank">在线JSON格式化</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://img.top/" title="智能图像压缩" target="_blank">智能图像压缩</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
    </header>
 
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/26/findjob-javascript1/" itemprop="url">
                  JavaScript-基础知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-26T14:23:17+08:00" content="2017-08-26">
              2017-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/FJ/" itemprop="url" rel="index">
                    <span itemprop="name">FJ</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>数据类型</p>
<p>  6种数据类型，其中包括5个基本数据类型：String、Number、Boolean、Null、Undefined，按值访问；1个复杂数据类型：Object，按引用访问。</p>
</li>
<li><p>html允许跨域的标签</p>
<p>  script、link、img、video、audio、frame、iframe、embed等有src属性的标签，以及object（data属性）、applet（code属性），css中的@font-face。</p>
</li>
<li><p>call、applay和bind的区别</p>
<p>  bind通常用来重新绑定函数体中的this并放回一个具有指定this的函数，多次bind是无效的。call和apply则表示重新指定this并调用返回结果，区别在于call采用多个实参的方式传参，apply则是使用一个数组。</p>
<p>  共同点：第一个参数指定为this，第二个参数起为参数传递。</p>
<p>  不同点：bind是用来返回具有特定this的函数，call和apply都是改变上下文中的this并立即执行这个函数。</p>
</li>
<li><p>单页应用(SPA)和多页应用(MPA)</p>
<p>  单页应用将所有的活动局限于一个Web页面中，仅在该Web页面初始化时加载相应的HTML、JavaScript和CSS。一旦页面加载完成了，SPA不会因为用户的操作而进行页面的重新加载或跳转。取而代之的是利用JavaScript动态的变换HTML的内容，从而实现UI与用户的交互。由于避免了页面的重新加载，SPA可以提供较为流畅的用户体验，但不利于SEO。MVVM这类最适合做单页面应用。</p>
<p>  多页面一般每个页面都有一个入口页面，页面跳转用普通的<code>&lt;a href=\&quot;\&quot;&gt;&lt;/a&gt;</code>，会进行整个页面的刷新。</p>
</li>
<li><p>发布订阅模式</p>
<p>  订阅发布模式定义了一种一对多的依赖关系，让多个订阅者对象同时监听某一个主题对象。这个主题对象在自身状态变化时，会通知所有订阅者对象，使它们能够自动更新自己的状态。当一个对象的改变需要同时改变其它对象，而且它还不知道具体有多少对象需要改变时，就可以使用订阅发布模式了。</p>
<p>  观察者模式与发布订阅模式很像，虽然两种模式都存在订阅者和发布者（具体观察者可认为是订阅者、具体目标可认为是发布者），区别是观察者模式是由具体目标调度的，而发布订阅模式是统一由调度中心调的，所以观察者模式的订阅者与发布者之间是存在依赖的，而发布订阅模式则不会。</p>
</li>
<li><p>纯函数</p>
<p>  纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用，JavaScript中指不依赖于且不改变它作用域之外的变量状态的函数。只要是跟函数外部环境发生的交互就都是副作用，副作用可能包含但不限于：</p>
<blockquote>
<p>更改文件系统<br>往数据库插入记录<br>发送一个 http 请求<br>可变数据<br>打印/log等IO操作<br>获取用户输入<br>DOM 查询<br>访问系统状态<br>访问系统时钟</p>
</blockquote>
</li>
<li><p>属性特性</p>
<p>  ES5定义了一个名叫“属性描述符”的对象，用于描述属性的各种特征，只能在Object.defineProperty或Object.defineProperties中使用。属性描述符对象有：</p>
<p>  4个属性：</p>
<blockquote>
<p>configurable: 可配置性，表示能否修改属性特性，能否把属性修改为访问器属性，或者能否通过delete删除属性从而重新定义属性，默认true。设置为false后，再调用Object.defineProperty修改属性特性都会报错。<br>enumerable: 可枚举性，表示能否通过for-in遍历得到属性，默认true。<br>writable: 可写性，表示能否修改属性的值，默认为true。<br>value: 数据属性，表示属性的值，默认为undefined。</p>
</blockquote>
<p>  2个存取器属性，分别是get和set，可以代替value和writable，存取器和value、writable不能同时存在：</p>
<blockquote>
<p>get: 在读取属性时调用的函数，只指定get则表示属性为只读属性，默认值为undefined。<br>set: 在写入属性时调用的函数，只指定set则表示属性为只写属性，默认值为undefined。</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// 修改obj的name属性特性</div><div class="line">Object.defineProperty(obj, &apos;name&apos;, &#123;</div><div class="line">    writable: false,</div><div class="line">    value: &apos;Tom&apos;,</div><div class="line">)&#125;;</div><div class="line">// 一次修改obj的多个属性特性</div><div class="line">Object.defineProperties(obj, &#123;</div><div class="line">    _year: &#123;</div><div class="line">        value: 2017,</div><div class="line">    &#125;,</div><div class="line">    edition: &#123;</div><div class="line">        value: 1,</div><div class="line">        writable: true,</div><div class="line">    &#125;,</div><div class="line">    year: &#123;</div><div class="line">        get: function() &#123;</div><div class="line">            return this._year;</div><div class="line">        &#125;,</div><div class="line">        set: function() &#123; ... &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">// 读取属性特性</div><div class="line">Object.getOwnPropertyDescriptor(obj, &apos;_year&apos;);</div><div class="line">// 读取所有属性特性</div><div class="line">Object.getOwnPropertyDescriptors(obj);</div></pre></td></tr></table></figure>
<p>  Object.preventExtensions(obj) 禁止扩展，禁止给对象添加属性和方法，原有的属性可修改<br>  Object.isExtensible(obj) 检查是否可扩展<br>  Object.seal() 密封对象，不可扩展、不可删除属性<br>  Object.isSeal() 检查是否密封<br>  Object.freeze() 冻结对象，不可扩展、不可删除、不可修改属性<br>  Object.isFrozen() 检查是否冻结</p>
</li>
<li><p>事件冒泡</p>
<p>  事件冒泡，从内到外；事件捕获，从外到内；DOM事件流，从外到内再从内到外回到原点。事件冒泡允许多个操作被集中处理，把事件处理器添加到一个父级元素上，避免把事件处理器添加到多个子级元素上，可以优化性能，在页面动态添加新元素后，这些新增的元素也不用再绑定事件，它还可以让你在对象层的不同级别捕获事件。</p>
<p>  blur、focus、load、unload不冒泡。使用addEventListener绑定事件的方法第三个参数可以控制事件触发顺序，true为事件捕获，false为事件冒泡，默认为false。使用attachEvent绑定事件的方法不能控制事件触发顺序。</p>
<p>  阻止事件冒泡不能阻止对象默认行为，如submit按钮会提交表单数据。</p>
<p>  事件对象：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">event.keyCode // 返回keydown何keyup事件发生的时候按键的代码</div><div class="line">event.target // 发生事件的目标元素</div><div class="line">event.currentTarget // 当前处理事件的元素</div></pre></td></tr></table></figure>
<p>  阻止冒泡：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">event.stopPropagation();</div><div class="line">event.stopImmediatePropagation(); // 除了该事件的冒泡行为被阻止之外，该元素绑定的后序相同类型事件的监听函数的执行也将被阻止</div><div class="line">window.event.cancelBubble = true; // IE下</div></pre></td></tr></table></figure>
<p>  阻止默认行为：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">event.preventDefault();</div><div class="line">window.event.returnValue = false; // IE下</div></pre></td></tr></table></figure>
<p>  在body上处理事件：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">window.onload = function() &#123;</div><div class="line">  document.body.addEventListener(&apos;click&apos;, function(e)&#123;</div><div class="line">    console.log(e.target.id);</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>cookie和session的区别与联系，怎么实现</p>
<p>  cookie和session都是用来跟踪浏览器用户身份的会话方式。cookie数据保存在客户端，session数据保存在服务器端。考虑到安全应当使用session，考虑到减轻服务器性能方面，应当使用cookie。</p>
<p>  如果web服务器端使用的是session，那么所有的数据都保存在服务器上，客户端每次请求服务器的时候会发送当前会话的sessionid，保存sessionid的方式可以采用cookie、url重写等方式，存储于浏览器内存中，服务器根据当前sessionid判断相应的用户数据标志，以确定用户是否登录或具有某种权限。由于数据是存储在服务器上面，所以你不能伪造，但是如果你能够获取某个登录用户的sessionid，用特殊的浏览器伪造该用户的请求也是能够成功的。sessionid是服务器和客户端链接时候随机分配的，一般来说是不会有重复，但如果有大量的并发请求，也不是没有重复的可能性。</p>
<p>  如果浏览器使用的是cookie，那么所有的数据都保存在浏览器端，比如你登录以后，服务器设置了cookie用户名，那么当你再次请求服务器的时候，浏览器会将用户名一块发送给服务器，这些变量有一定的特殊标记。如果不设置过期时间，则表示这个cookie的生命期为浏览器会话期间，关闭浏览器窗口cookie就消失。如果设置了的过期时间，浏览器会将cookie保存在客户端的硬盘上，下次再访问该网站的时候，浏览器先检查有没有cookie，如果有的话就读取该cookie，然后发送给服务器。如果直接将cookie文件拷贝到别人的浏览器目录下面，浏览器是不认的，因为它有一个index.dat文件，存储了cookie文件的建立时间，以及是否有修改，所以必须要先有该网站的cookie文件，并且要从保证时间上骗过浏览器，才能保证拷贝的cookie能生效。所以，cookie是可以伪造的，使用cookie被攻击的可能性比较大。</p>
</li>
<li><p>Web Storage包括哪几种方式，区别是什么，没出现之前怎么做的</p>
<p>  HTML5中的Web Storage包括了两种存储方式：sessionStorage和localStorage。在没有Web Storage之前，是通过Cookie来在客户端存储数据的。</p>
<p>  sessionStorage用于本地存储一个会话（session）中的数据，这些数据只有在同一个会话中的页面才能访问，刷新页面数据依旧存在，但是当会话结束也就是页面关闭后数据也随之销毁。因此sessionStorage不是一种持久化的本地存储，仅仅是会话级别的存储。</p>
<p>  localStorage用于持久化的本地存储，可用于所有同源窗口或标签页（相同的域名、协议和端口），除非主动删除数据，否则数据是永远不会过期的。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">Cookie</th>
<th style="text-align:left">Web Storage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">4KB左右</td>
<td style="text-align:left">5MB左右</td>
</tr>
<tr>
<td style="text-align:left">自己封装setCookie、getCookie</td>
<td style="text-align:left">提供setItem、getItem等api</td>
</tr>
<tr>
<td style="text-align:left">可设置失效时间</td>
<td style="text-align:left">localStorage永久保存、sessionStorage会话级别</td>
</tr>
<tr>
<td style="text-align:left">HTTP规范的一部分，同源的请求都带Cookie</td>
<td style="text-align:left">仅在客户端保存数据，不参与和服务器的通信</td>
</tr>
</tbody>
</table>
<ul>
<li><p>正则表达式中test、exec、match</p>
<p>  <strong>test</strong>查找对应的字符串中是否存在模式，返回Boolean。当一个具有g标志的正则表达式调用test方法时，它的行为和exec相同，会从上个匹配的位置(index + 当前匹配项的长度)开始查找，这样我们就可以使用方法test来遍历字符串了。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var str = &quot;1a1b1c&quot;;</div><div class="line">var reg = new RegExp(&quot;1.&quot;, &quot;g&quot;);</div><div class="line">console.log(reg.test(str)); // true</div><div class="line">console.log(reg.test(str)); // true</div><div class="line">console.log(reg.test(str)); // true</div><div class="line">console.log(reg.test(str)); // false</div></pre></td></tr></table></figure>
<p>  <strong>exec</strong>查找并返回当前的匹配结果，并以数组的形式返回，如果不存在模式则返回null，否则总是返回一个长度为1的数组，其值就是当前匹配项，还有两个属性：index为当前匹配项的位置；input就是参数字符串。exec方法受参数g的影响。若指定了g，则下次调用exec时，会从上个匹配的位置(index+当前匹配项的长度)开始查找。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str = &quot;1a1b1c&quot;;</div><div class="line">var reg = new RegExp(&quot;1.&quot;, &quot;g&quot;);</div><div class="line">console.log(reg.exec(str)); // [&quot;1a&quot;, index: 0, input: &quot;1a1b1c&quot;]</div><div class="line">console.log(reg.exec(str)); // [&quot;1b&quot;, index: 2, input: &quot;1a1b1c&quot;]</div></pre></td></tr></table></figure>
<p>  <strong>match</strong>是String对象的一个方法。match这个方法有点像exec，但exec是RegExp对象的方法。二者有一个不同点，就是对参数g的解释。如果指定了参数g，那么match一次返回所有的结果组成的数组，没有匹配则返回null。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var str = &quot;1a1b1c&quot;;</div><div class="line">var reg = new RegExp(&quot;1.&quot;, &quot;g&quot;);</div><div class="line">console.log(str.match(reg)); // [&quot;1a&quot;, &quot;1b&quot;, &quot;1c&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>dom ready 的实现</p>
<p>  window.onload事件是等到页面上的所有资源被加载才激活，包括页面上的许多图片、音乐或falsh等资源。如果要做绑定事件、DOM操作某节点等事情，使用window.onload有点太“迟”了，比较影响用户体验。为了解决这个问题，Firefox为DOM纳入一个全新事件DOMContentLoaded，也就是后来所说的DOMReady，是在DOM树构建完毕执行，无需等待其它资源的加载，因此是在onload前加载的。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">// DOM已加载，比window.onload快，可以有多个，按序执行</div><div class="line">jQuery(document).ready(function() &#123;</div><div class="line">    ...</div><div class="line">&#125;);</div><div class="line">// 也是在页面所有元素加载完毕后执行的，但是可加载多个函数，并且可以做到js和html完全分离</div><div class="line">$(window).load(function() &#123;</div><div class="line">    ...</div><div class="line">&#125;);</div><div class="line">$(window).load(function() &#123;</div><div class="line">    ...</div><div class="line">&#125;);</div><div class="line">// 页面关闭时引发</div><div class="line">$(window).unload(function() &#123;</div><div class="line">    ...</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// IE浏览器没有添加DOMContentLoaded事件，以下是jQuery对该事件的兼容性实现</div><div class="line">function domReady() &#123;</div><div class="line">    if (readyBound) return;</div><div class="line">    readyBound = true;</div><div class="line">    if (document.addEventListener) &#123;// 对于非IE的处理</div><div class="line">        document.addEventListener(&quot;DOMContentLoaded&quot;, function() &#123;</div><div class="line">            document.removeEventListener(&quot;DOMContentLoaded&quot;, arguments.callee, false);</div><div class="line">            jQuery.ready();</div><div class="line">        &#125;, false);</div><div class="line">    &#125; else if (document.attachEvent) &#123;// 对于IE的处理</div><div class="line">        // 如果是在iframe中，通过document的onReadyStateChange实现</div><div class="line">        document.attachEvent(&quot;onReadyStateChange&quot;, function() &#123;</div><div class="line">            if (document.readyState === &quot;complete&quot;) &#123;</div><div class="line">                document.detachEvent(&quot;onReadyStateChange&quot;, arguments.callee);</div><div class="line">                jQuery.ready();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        // 如果页面不在iframe中，通过setTimeout不断调用documentElement的doScroll方法直到调用成功</div><div class="line">        if (document.documentElement.doScroll &amp;&amp; typeof window.frameElement === &quot;undefined&quot;) &#123;</div><div class="line">            (function() &#123;</div><div class="line">                if (jQuery.isReady) return;</div><div class="line">                try &#123;</div><div class="line">                    document.documentElement.doScroll(&quot;left&quot;);</div><div class="line">                &#125; catch(error) &#123;</div><div class="line">                    setTimeout(arguments.callee, 0);</div><div class="line">                    return;</div><div class="line">                &#125;</div><div class="line">                jQuery.ready();</div><div class="line">            &#125;)();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    jQuery.event.add(window, &quot;load&quot;, jQuery.ready);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>img标签的图片怎么占高</p>
<p>  img外层要有div，如果已知图片宽高可直接指定div的宽高，然后将img的width样式设成100%。也可以使用预览图占位。</p>
<p>  获取图片原始尺寸：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// js获取</div><div class="line">var img = document.getElementsByTagName(&apos;img&apos;)[0];</div><div class="line">function getImgNaturalDimensions(img, callback) &#123;</div><div class="line">    var nWidth, nHeight</div><div class="line">    if (img.naturalWidth) &#123; // 现代浏览器</div><div class="line">        nWidth = img.naturalWidth</div><div class="line">        nHeight = img.naturalHeight</div><div class="line">    &#125; else &#123; // IE6/7/8</div><div class="line">        // js创建一个Image</div><div class="line">        var imgae = new Image();</div><div class="line">        image.src = img.src;</div><div class="line">        image.onload = function() &#123;</div><div class="line">            callback(image.width, image.height);</div><div class="line">        &#125;</div><div class="line">        // jQuery创建img</div><div class="line">        $(&quot;&lt;img/&gt;&quot;).attr(&quot;src&quot;, $(img).attr(&quot;src&quot;)).load(function() &#123;</div><div class="line">            callback(image.width, image.height);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    return [nWidth, nHeight];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>js跨域的解决办法</p>
<p>  浏览器都有一个同源策略，其限制之一是不能通过ajax的方法去请求不同源中的文档；第二是限制浏览器中不同域的框架之间是不能进行js的交互操作的。但是不同的框架之间（父子或同辈），是能够获取到彼此的window对象的，但却不能使用获取到的window对象的属性和方法，<strong>postMessage方法除外，</strong>可以当做是只能获取到一个几乎无用的window对象。只要协议、域名、端口有任何一个不同，都被当作是不同的域。要解决跨域的问题，我们可以使用以下几种方法：</p>
<p>  <strong>方式一、通过jsonp跨域</strong></p>
<p>  jsonp是利用<code>&lt;script&gt;</code>标签可以引入不同域上的js脚本文件来实现的，通过script标签引入一个js文件，这个js文件载入成功后会执行我们在url参数中指定的函数，并且会把我们需要的json数据作为参数传入。所以jsonp是需要服务器端的页面进行相应的配合的。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">js原生写法，通过http://example.com/data.php?callback=dosomething得到的js文件，就是我们之前定义的dosomething函数,并且它的参数就是我们需要的json数据，这样就跨域获得了我们需要的数据。</div><div class="line">*/</div><div class="line">&lt;script&gt;</div><div class="line">    function dosomething(jsondata) &#123;</div><div class="line">        // 相应操作</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;script src=&quot;http://example.com/data.php?callback=dosomething&quot;&gt;&lt;/script&gt;</div><div class="line"></div><div class="line">/*</div><div class="line">jQuery写法，jQuery会自动生成一个全局函数来替换callback=?中的问号，之后获取到数据后又会自动销毁。$.getJSON方法会自动判断是否跨域，不跨域就调用普通的ajax方法，跨域会以异步加载js文件的形式来调用jsonp的回调函数。</div><div class="line">*/</div><div class="line">&lt;script&gt;</div><div class="line">    $.getJSON(&apos;http://example.com/data.php?callback=?&apos;, function(jsondata)&#123;</div><div class="line">        // 相应操作</div><div class="line">    &#125;);</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>  <br></p>
<p>  <strong>方式二、通过修改document.domain来跨子域</strong></p>
<p>  针对不同域的框架这种情况，是无法通过在页面中书写js代码来获取iframe中的东西的，这个时候可以使用document.domain，把这两个页面的document.domain都设成相同的域名就可以了。但要注意，只能把document.domain设置成自身或更高一级的父域，且主域必须相同，如果当前文档的domain就是要设置的域名，还是必须显示的设置<br>  document.domain。这样我们就可以通过js访问到iframe中的各种属性和对象了。</p>
<p>  <code>http://www.example.com/a.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;iframe src=&quot;http://example.com/b.html&quot; id=&quot;iframe&quot; onLoad=&quot;test()&quot;&gt;&lt;/iframe&gt;</div><div class="line">&lt;script&gt;</div><div class="line">    document.domain = &apos;example.com&apos;; // 设置成主域</div><div class="line">    function test() &#123;</div><div class="line">        alert(document.getElementById(&apos;iframe&apos;).contentWindow);</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>  <code>http://example.com/b.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    // 在iframe载入的这个页面也设置document.domain，使之与主页面的document.domain相同</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>  但是如果想在a.html页面中通过ajax直接请求b.html页面，即使设置了相同的document.domain也还是不行的，修改document.domain的方法只适用于不同子域的框架间的交互。如果想通过ajax的方法去与不同子域的页面交互，除了使用jsonp的方法外，还可以用一个隐藏的iframe来做一个代理。原理就是让这个iframe载入一个与你想要通过ajax获取数据的目标页面处在相同域的页面，这个iframe中的页面是可以正常使用ajax去获取你要的数据的，然后通过修改document.domain的方法，通过js完全控制这个iframe，这样就可以让iframe去发送ajax请求，然后收到的数据我们也可以获取到。</p>
<p>  <strong>方式三、使用window.name来进行跨域</strong></p>
<p>  window.name属性有个特征，即在一个窗口(window)的生命周期内，窗口载入的所有的页面都是共享一个window.name的，即使这些页面是不同域的或url发生变化，每个页面对window.name都有读写的权限，window.name是持久存在一个窗口载入过的所有页面中的，不会因新页面的载入而进行重置。window.name的值只能是字符串的形式，最大能允许2M左右甚至更大的一个容量，具体取决于不同的浏览器，但一般是够用了。例如<code>www.example.com/a.html</code>页面里的js需要获取另一个位于不同域的页面<code>www.cnblogs.com/data.html</code>里的数据，示例代码如下：</p>
<p>  <code>www.cnblogs.com/data.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    window.name = &apos;我就是页面a.html想要的数据，所有可以转化成字符串来传递的数据都可以在这里使用！！！&apos;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>  <code>www.example.com/a.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;!doctype html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">    &lt;head&gt;</div><div class="line">        &lt;meta charset=&quot;utf-8&quot; /&gt;</div><div class="line">        &lt;title&gt;window.name跨域&lt;/title&gt;</div><div class="line">        &lt;script&gt;</div><div class="line">            function getData() &#123;</div><div class="line">                var iframe = document.getElementById(&apos;proxy&apos;);</div><div class="line">                // 这个时候a.html与iframe已经是同源了，可以互相访问</div><div class="line">                iframe.onload = function() &#123;</div><div class="line">                    // 获取iframe里的window.name，也就是data.html页面给它设置的数据</div><div class="line">                    var data = iframe.contentWindow.name;</div><div class="line">                    alert(data);</div><div class="line">                &#125;;</div><div class="line">                // 这里的b.html为随便的一个页面，只要与a.html同源的就行</div><div class="line">                iframe.src = &apos;b.html&apos;;</div><div class="line">            &#125;</div><div class="line">        &lt;/script&gt;</div><div class="line">    &lt;/head&gt;</div><div class="line">    &lt;body&gt;</div><div class="line">        &lt;iframe id=&quot;proxy&quot; src=&quot;http://www.cnblogs.com/data.html&quot; style=&quot;display:none&quot; onload=&quot;getData()&quot; /&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>  <strong>方式四、使用HTML5中新引进的window.postMessage方法来跨域传送数据</strong></p>
<p>  <code>window.postMessage(message, targetOrigin)</code>方法是html5新引进的特性，不支持IE6、7旧浏览器，可以向其它的window对象发送消息，无论这个window对象是属于同源或不同源，该方法的第一个参数message为要发送的消息，类型只能为字符串；第二个参数targetOrigin用来限定接收消息的那个window对象所在的域，如果不想限定域，可以使用通配符 * 。接收消息的window对象，通过监听自身的message事件来获取传过来的消息，消息内容储存在该事件对象的data属性中。</p>
<p>  <code>test.com/a.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    function onLoad() &#123;</div><div class="line">        var iframe = document.getElementById(&quot;iframe&quot;);</div><div class="line">        var win = iframe.contentWindow;</div><div class="line">        // 向不同域发送消息</div><div class="line">        win.postMessage(&apos;我是来自页面a的消息！&apos;, &apos;*&apos;);</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;iframe id=&quot;iframe&quot; src=&quot;http://www.test.com/b.html&quot; onload=&quot;onLoad()&quot; /&gt;</div></pre></td></tr></table></figure>
<p>  <code>www.test.com/b.html</code>中：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;</div><div class="line">    window.onmessage = function(e) &#123;</div><div class="line">        e = e || event;</div><div class="line">        alert(e.data);</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>有分号和没分号的区别</p>
<p>  <a href="https://www.zhihu.com/question/20298345" target="_blank" rel="external">JavaScript 语句后应该加分号么？</a></p>
<p>  通常情况下，解释器会自动添加分号，但有些时候不加分号还是容易引起解析错误，特别是在代码压缩的情况下，所以出于严谨考虑，还是推荐在语句结束时添加分号。还有不要把分号单单认为只是用来结束某段代码，它还可以用来隔离某段代码和别人划清界限。</p>
<p>  如果遇到无法解析下去则javascript解析器会尝试给其添加一个分号，如果还是解析不了则报错。javascript解析器会尽可能多的去匹配，但也有几个例外，它们是retrun、break、continue，当javascript解析器解析到这几个关键字时，它不会把换行后的内容当成是自身的，而是直接在换行之前添加分号。</p>
<p>  JavaScript自动加分号规则，有3条：</p>
<blockquote>
<p>当有换行符（包括含有换行符的多行注释），并且下一个token没法跟前面的语法匹配时，会自动补分号。<br>当有<code>}</code>时，如果缺少分号，会补分号。<br>当程序源代码结束时，如果缺少分号，会补分号。</p>
</blockquote>
<p>  真正会导致上下行解析出问题的 token 有5个：括号，方括号，正则开头的斜杠，加号，减号。实际代码中几乎没有用正则、加号、减号作为行首的情况，所以一行开头是括号或者方括号的时候加上分号就可以了，其它时候全部不需要。</p>
<blockquote>
<p>在return、break、continue、后自增、后自减五种语句中，换行符可以完全替代分号的作用。<br>var if do while for continue break return with switch throw try debugger几种关键字开头的语句，以及空语句，上一行加不加分号影响不大。<br>凡表达式语句和函数表达式语句，后面不加分号非常危险，情况极其复杂。<br>凡<code>(</code>和<code>[</code>开头的语句，前面不加分号极度危险。</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 例子1</div><div class="line">var a = 10;</div><div class="line">var b = 5;</div><div class="line">var c = a + b</div><div class="line">(a + b).toString() // b is not a function，同 var c = a + b(a + b).toString();</div><div class="line"></div><div class="line">// 例子2</div><div class="line">function test()&#123;</div><div class="line">  return </div><div class="line">  123;</div><div class="line">&#125;</div><div class="line">console.log(test()); // undefined，同 return;</div></pre></td></tr></table></figure>
</li>
<li><p>变量提升基础</p>
<p>  注意js运行时先执行变量提升，然后在从上往下执行。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">相当于：</div><div class="line">var a;</div><div class="line">function a() &#123;&#125;</div><div class="line">a = 1;</div><div class="line">*/</div><div class="line">var a = 1;</div><div class="line">function a() &#123;&#125;</div><div class="line">console.log(a); // 输出 1</div></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">相当于：</div><div class="line">var a;</div><div class="line">a = &#123;</div><div class="line">    x: &apos;x&apos;,</div><div class="line">    a: a, // 此时a是undefined</div><div class="line">&#125;;</div><div class="line">*/</div><div class="line">var a = &#123;</div><div class="line">    x: &apos;x&apos;,</div><div class="line">    a: a,</div><div class="line">&#125;;</div><div class="line">console.log(a); // 输出 &#123;x: &quot;x&quot;, a: undefined&#125;</div></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var a = &#123;x:&apos;x&apos;&#125;;</div><div class="line">a.a = a;</div><div class="line">console.log(a); // 输出 &#123;x: &quot;x&quot;, a: &#123;…&#125;&#125; a可以无限展开</div></pre></td></tr></table></figure>
</li>
<li><p>prototype基础</p>
<p>  任何对象都有<code>__proto__</code>，只有函数对象才有<code>prototype</code>，prototype.constructor指回自己，函数被当作构造函数创建实例时它的prototype将作为实例的<code>__proto__</code>。在定义prototype是显示的将constructor指向函数自己，否则constructor将指向Object，通过constructor已经无法确定对象的类型了。还有显示定义了constructor后在对象实例中是可枚举的。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function feed() &#123;</div><div class="line">    this.a = &apos;hello&apos;;</div><div class="line">&#125;</div><div class="line">feed.a = &apos;word&apos;;</div><div class="line">var f = new feed();</div><div class="line">console.log(f.a); // 输出 &apos;hello&apos;</div><div class="line">console.log(f.__proto__.a); // 输出 undefined</div><div class="line">console.log(f.__proto__.constructor.a); // 输出 &apos;word&apos;</div></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">function feed() &#123;</div><div class="line">    this.a = &apos;hello&apos;;</div><div class="line">&#125;</div><div class="line">feed.prototype = &#123;</div><div class="line">    b: &apos;www&apos;,</div><div class="line">&#125;;</div><div class="line">console.log(feed.prototype.constructor); // 输出 ƒunction Object() &#123; [native code] &#125;</div><div class="line">feed.prototype = &#123;</div><div class="line">    constructor: feed,</div><div class="line">    b: &apos;www&apos;,</div><div class="line">&#125;;</div><div class="line">console.log(feed.prototype.constructor); // 输出 ƒunction feed() &#123; this.a = &apos;hello&apos;; &#125;</div><div class="line">var f = new feed();</div><div class="line">for(var key in f) &#123;</div><div class="line">    console.log(key); // 依次输出 a、constructor、b</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>左值和右值</p>
<p>  按字面意思，通俗地说，以赋值符号=为界，=左边的就是左值，=右边就是右值。更深一层，可以将L-value的L，理解成Location，表示定位、地址。将R-value的R理解成 Read，表示读取数据。现在的计算机数据放在内存。内存有两个很基本的属性：内存地址和内存里面放的数据。想象完全一样的箱子。每个箱子有个编号，用来区分到底是哪个箱子，箱子里面可以放东西。内存地址相当于箱子的编号，内存的数据，相当于箱子里面放的东西。变量名编译之后，会映射成内存地址。操作a=b的含义，其实就是将”b地址内存里面的数据”，放到”a地址内存”中。</p>
<p>  可以放在赋值符号左边的变量，即具有对应的可以由用户访问的存储单元，并且能够由用户去改变其值的量。左值表示存储在计算机内存的对象，而不是常量或计算的结果。或者说左值是代表一个内存地址值，并且通过这个内存地址，就可以对内存进行读并且写（主要是能写）操作；这也就是为什么左值可以被赋值的原因了。相对应的还有右值：当一个符号或者常量放在操作符右边的时候，计算机就读取他们的“右值”，也就是其代表的真实值。简单来说就是，左值相当于地址值，右值相当于数据值。右值指的是引用了一个存储在某个内存地址里的数据。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1 = 2; // Uncaught ReferenceError: Invalid left-hand side in assignment</div><div class="line">const a; // Uncaught SyntaxError: Missing initializer in const declaration</div><div class="line">const b = 1;</div><div class="line">b = 2; // Uncaught TypeError: Assignment to constant variable</div></pre></td></tr></table></figure>
</li>
<li><p>undefined</p>
<p>  undefined 表示一个未声明的变量，或已声明但没有赋值的变量，或一个并不存在的对象属性，函数没有返回值时，默认返回undefined。这是undefined的几种典型用法，而判断一个变量是不是undefined，用typeof函数，typeof函数主要是返回的是字符串，主要有：”number”、”string”、”boolean”、”object”、”function”、”undefined”。注意对于未声明的变量，typeof 也会返回undefined。</p>
<p>  null 是一个空的对象引用，undefined是声明但没有被赋值的变量，利用这两个就可以区分空对象指针和未经初始化的变量。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">console.log(null == undefined); // true</div><div class="line">console.log(null === undefined); // false</div></pre></td></tr></table></figure>
</li>
<li><p>实现super</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">Object.prototype.mysuper = function()&#123;</div><div class="line">    // 返回一个对函数的引用，该函数调用了当前函数，不能使用arguments.callee.name，arguments.callee.name的值为mysuper</div><div class="line">    var caller = arguments.callee.caller;</div><div class="line">    var name;</div><div class="line">    for(var key in this)&#123;</div><div class="line">        if(this[key] === caller)&#123;</div><div class="line">            name = key;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    __proto = this.__proto__ || this.constructor.prototype;</div><div class="line">    return __proto[name]();</div><div class="line">&#125;</div><div class="line">function Class()&#123;</div><div class="line">    this.name = &quot;class&quot;;</div><div class="line">    this.setName = function(name)&#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line">    this.getName = function()&#123;</div><div class="line">        return this.name;</div><div class="line">    &#125;</div><div class="line">    this.method = function() &#123;</div><div class="line">        console.log(&quot;父类方法&quot;);</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">function Test()&#123;</div><div class="line">    this.getName = function()&#123;</div><div class="line">        return &apos;sub-&apos; +  this.mysuper();</div><div class="line">    &#125;</div><div class="line">    this.method = function() &#123;</div><div class="line">        this.mysuper();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">// 实现继承</div><div class="line">Test.prototype = new Class();</div><div class="line">Test.prototype.constructor = Test;</div><div class="line"></div><div class="line">var a = new Test();</div><div class="line">console.log(a.getName()); // sub-class</div><div class="line">a.method(); // 父类方法</div></pre></td></tr></table></figure>
</li>
<li><p>如何使用CSS实现如图效果，其中矩形：width=200px height=100px，三角形：底为40px 高为50px，并垂直居中于矩形右侧。</p>
<img src="/2017/08/26/findjob-other/css1.png" title="效果图">
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">        * &#123;</div><div class="line">            margin: 0;</div><div class="line">            padding: 0;</div><div class="line">        &#125;</div><div class="line">        .rec &#123;</div><div class="line">            width: 200px;</div><div class="line">            height: 100px;</div><div class="line">            background-color: #000;</div><div class="line">        &#125;</div><div class="line">        /* 第一个 */</div><div class="line">        .main1 &#123;</div><div class="line">            position: relative;</div><div class="line">        &#125;</div><div class="line">        #triangle-right1 &#123;</div><div class="line">            width: 0;</div><div class="line">            height: 0;</div><div class="line">            border-top: 20px solid transparent;</div><div class="line">            border-left: 50px solid red;</div><div class="line">            border-bottom: 20px solid transparent;</div><div class="line">            position: absolute;</div><div class="line">            top: 50%;</div><div class="line">            left: 200px;</div><div class="line">            margin-top: -20px;</div><div class="line">        &#125;</div><div class="line">        /* 第二个 */</div><div class="line">        .main2 &#123;</div><div class="line">            margin-top: 10px;</div><div class="line">            display: -webkit-flex; </div><div class="line">            display: -o-flex;   // 欧鹏浏览器</div><div class="line">            display: -ms-flex;  // ie</div><div class="line">            display: -moz-flex; //火狐</div><div class="line">            display: flex;</div><div class="line">            align-items: center; // 侧轴，垂直方向</div><div class="line">        &#125;</div><div class="line">        #triangle-right2 &#123;</div><div class="line">            width: 0;</div><div class="line">            height: 0;</div><div class="line">            border-top: 20px solid transparent;</div><div class="line">            border-left: 50px solid red;</div><div class="line">            border-bottom: 20px solid transparent;</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main1"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"rec"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"triangle-right1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main2"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"rec"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"triangle-right2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/26/findjob-react1/" itemprop="url">
                  React-基础知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-26T14:22:55+08:00" content="2017-08-26">
              2017-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/FJ/" itemprop="url" rel="index">
                    <span itemprop="name">FJ</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>react的优缺点</p>
<p>  优点：</p>
<blockquote>
<p>虚拟dom加diff算法减少dom操作来提高渲染性能<br>虚拟dom也帮助我们解决了跨浏览器问题<br>使用声明式语法JSX来重新定义视图开发<br>代码更加模块化，重用代码更容易<br>单向数据流，灵活、可预计、可控制<br>将DOM操作抽象为状态的改变<br>只从this.props和this.state生成HTML，非常的函数式编程<br>能够快速上手react-native开发ios或者android项目</p>
</blockquote>
<p>  缺点：</p>
<blockquote>
<p>本身只是View，如果是大型项目基本都需要加上React Router和Redux<br>大多数坑没踩出来  </p>
</blockquote>
</li>
<li><p>AMD(Asynchronous Module Definition)、CMD(Common Module Definition)、CommonJS</p>
<p>  AMD、CMD、CommonJS是JS模块化开发的标准，CommonJS是用在服务器端的，同步的，如Node.js。AMD、CMD是用在浏览器端的，异步的，如RequireJS和SeaJS。其中，AMD先提出，CMD是根据CommonJS和AMD基础上提出的。 </p>
<p>  CommonJS 加载模块是同步的，所以只有加载完成才能执行后面的操作。像Node.js主要用于服务器的编程，加载的模块文件一般都已经存在本地硬盘，所以加载起来比较快，不用考虑异步加载的方式，所以CommonJS规范比较适用。但如果是浏览器环境，要从服务器加载模块，这是就必须采用异步模式，所以就有了AMD和CMD解决方案。 </p>
<p>  AMD和CMD的区别有以下几点： </p>
</li>
</ul>
<pre><code>&gt; **AMD推崇依赖前置，CMD推崇依赖就近。AMD和CMD最大的区别是对依赖模块的执行时机处理不同** 
&gt; 对于依赖的模块AMD是提前执行，CMD是延迟执行。不过RequireJS从2.0开始，也改成可以延迟执行。 
&gt; AMD的api默认是一个当多个用，CMD严格的区分推崇职责单一。例如：AMD里require分全局的和局部的。CMD里面没有全局的require，提供seajs.use()来实现模块系统的加载启动。CMD里每个API都简单纯粹。 

UMD(Universal Module Definition 通用模块规范)，因为AMD，CommonJS规范是两种不一致的规范，虽然他们应用的场景也不太一致，但是人们仍然是期望有一种统一的规范来支持这两种规范。于是，UMD规范诞生了。
</code></pre><ul>
<li><p>为什么不能改变原有state，需要使用setState并传入修改的部分state，执行setState后怎么更新</p>
<p>  是否调用render进行再次渲染是由state是否变化决定的。setState本质是通过一个队列机制实现state更新的，执行setState时，会将要更新的state合并后放入状态队列，而不会立刻更新state，队列机制可以批量更新state。如果不通过setState而直接修改this.state，那么这次state的变化不会放入状态队列中，下次调用setState再进行状态队列进行合并时，会忽略之前直接直接对state修改，这样就无法合并到这次变化，实际也就没有将想要的state更新上去。setState是异步的。</p>
<p>  只要调用了setState，就会在合并后生成一个新的state，只要判断state指向的是否是同一个内存地址就知道state是否发生了变化，以此来决定是否进行render重新渲染。如果不用这种方式都直接操作this.state，也就是同一块内存，要侦测state是否发生变化（如angular中的deepwatch）来决定是否重新渲染会非常复杂和低效。redux的reducer中返回新的对象也是同理。react状态管理库还有redux-sagas、redux-observable、MobX等。</p>
</li>
<li><p>为什么组件中定义的方法要bind(this)</p>
<p>  ES5里，function内部的this默认为window，在严格模式下，this为undefined。ES5的写法React.createClass会自动绑定每个方法的this到当前组件实例，ES6的写法class XXX extends Component则不会自动为方法绑定this。</p>
<p>  bind()方法会创建一个新函数，当这个新函数被调用时，它的this值是传递给bind()的第一个参数，它的参数是bind()的其它参数和原本参数，这个函数不论怎么调用都有同样的this，也就是当前类的实例，否则this为undefined。绑定this的几种方式：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 方式一</div><div class="line">&lt;div onClick=&#123;this.handleClick.bind(this)&#125;&gt;save&lt;/div&gt;</div><div class="line">// 方式二</div><div class="line">constructor() &#123;</div><div class="line">    ...</div><div class="line">    this.handleClick = this.handleClick.bind(this);</div><div class="line">&#125;</div><div class="line">// 方式三</div><div class="line">&lt;div onClick=&#123;() =&gt; this.handleClick()&#125;&gt;save&lt;/div&gt;</div><div class="line">// 方式四</div><div class="line">handleClik = () =&gt; &#123;&#125;</div><div class="line">&lt;div onClick=&#123;this.handleClick&#125;&gt;save&lt;/div&gt;</div><div class="line">// 方式五</div><div class="line">ES6 Decorator,core-decorator.js提供了@autobind修饰器</div></pre></td></tr></table></figure>
<p>  方式一会在每次点击时通过bind创建一个新方法，一般使用方式二、方式三或方式四，其中方式三的箭头函数总是匿名的，如果打算移除监听事件可使用方式四。方式二在构造函数里绑定this后方法是属于实例的，而定义在类里的是非静态函数，在类的<code>prototype</code>上，实例的<code>__proto__</code>原型上。方式四使用箭头函数定义的方法也是这个效果。</p>
</li>
<li><p>数据获取为什么一定要在componentDidMount里面调用</p>
<p>  不建议在constructor和componentWillMount里写的原因是：会阻碍组件的实例化，阻碍组件的渲染；在componentWillMount里面触发setState不会重新渲染，在componentDidMount里面会触发setState会重新渲染，有副作用的代码都会集中在componentDidMount方法里。</p>
</li>
<li><p>webpack 打包常用</p>
<blockquote>
<p>webpack.optimize.CommonsChunkPlugin 分离应用和第三方</p>
<p>webpack.optimize.UglifyJsPlugin 清除打包后文件中的注释和copyright</p>
<p>webpack.optimize.DedupePlugin 保证重复的代码不被打包到bundle文件</p>
<p>extract-text-webpack-plugin 独立打包样式</p>
<p>optimize-css-assets-webpack-plugin css去重 </p>
<p>html-webpack-plugin 根据模板创建html入口文件，为引入的外部资源如script、link动态添加每次compile后的hash，防止引用缓存的外部文件问题</p>
<p>require.ensure 代码分割，可跟react-router的getComponent配合使用</p>
</blockquote>
<p>  常用loader：style-loader、css-loader、less-loader、url-loader、file-loader、babel-loader、react-hot</p>
</li>
<li><p>redux-thunk源码</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// ES6 写法</div><div class="line">function createThunkMiddleware(extraArgument) &#123;</div><div class="line">  return (&#123; dispatch, getState &#125;) =&gt; next =&gt; action =&gt; &#123;</div><div class="line">    if (typeof action === &apos;function&apos;) &#123;</div><div class="line">      return action(dispatch, getState, extraArgument);</div><div class="line">    &#125;</div><div class="line">    return next(action);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// ES5写法</div><div class="line">function createThunkMiddleware(extraArgument) &#123;</div><div class="line">  return function (_ref) &#123;</div><div class="line">    var dispatch = _ref.dispatch,</div><div class="line">        getState = _ref.getState;</div><div class="line">    return function (next) &#123;</div><div class="line">      return function (action) &#123;</div><div class="line">        if (typeof action === &apos;function&apos;) &#123;</div><div class="line">          return action(dispatch, getState, extraArgument);</div><div class="line">        &#125;</div><div class="line">        return next(action);</div><div class="line">      &#125;;</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>web端路由react-router和react-native的navigator有什么区别</p>
<p>  纯属个人理解：web端路由是保证url和UI一致的，进行的是局部刷新；react-native的Navigator是管理导航堆栈的，让用户清楚的知道自己当前所处的页面和返回的页面，进行的是整屏刷新。</p>
</li>
<li><p>Vue，React，Angular</p>
<p>  Vue。轻量级框架，双向数据绑定，语法和原理所需要的学习成本不是很高。具有高覆盖率的文档，绝大部分操作已被记录在案。但是如果一个操作没有文档记录，能在线上找到解决方案的几率也很小，因为Vue不如Angular或React更流行。Vue也有被称为Flux架构实现的Vuex，移动端跨平台方案Weex使用Vue的语法，但是Weex并不太完善。</p>
<p>  React。React通过使用VirtualDOM获得高效，单向数据流，可以使用JSX语法。与框架相关的Redux是一个非常棒的类Flux架构的实现，掌握React的知识后，可以直接上手基于ReactNative的移动客户端开发。随着React将会有一个能够向后兼容的重写版React Fiber的消息放出，React的”第二春”很快就会到来。</p>
<p>  AngularJS。以HTML为中心，适配和扩展了传统的HTML来呈现动态内容，双向数据绑定，自定义指令，是一个比较完善的前端框架，适合大型项目。入门很容易，但框架复杂、深入后概念很多，学习中较难理解，文档例子非常少。使用脏检查，当watcher越来越多时会变得越来越慢。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/10/emmet-base/" itemprop="url">
                  Emmet-基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-10T10:11:32+08:00" content="2017-07-10">
              2017-07-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/HTML/" itemprop="url" rel="index">
                    <span itemprop="name">HTML</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前两天参加JavaScript培训，老师在写HTML的时候提到Zen Coding，我之前没有听到过这个东西，但写起来感觉跟Emmet一样，回来特意查了一下。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Zen Coding 改名为 <a href="https://www.emmet.io/" target="_blank" rel="external">Emmet</a>，是一种快速编写HTML/CSS代码的方法。输入缩写代码，光标移到末尾，按扩展键（Tab键），即可得到代码片段。</p>
<h3 id="HTML基本用法"><a href="#HTML基本用法" class="headerlink" title="HTML基本用法"></a>HTML基本用法</h3><p>! —- 生成html页面结构如下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot;&gt;</div><div class="line">&lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</div><div class="line">    &lt;title&gt;Document&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">    </div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>元素名如div —- 生成元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p><code>#</code>如div#section1 —- 指定元素id<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;section1&quot;&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p><code>.</code>如div.className1 —- 元素类名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;className1&quot;&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p><code>[]</code>如a[alt title=name] —- 指定元素属性，用空格分隔多个属性，属性值用=赋值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href=&quot;&quot; alt=&quot;&quot; title=&quot;name&quot;&gt;&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p><code>{}</code>如a{click me} —- 文本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;a href=&quot;&quot;&gt;click me&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p><code>$</code>如 —- 自增符号，@-表示倒序，@指定开始序号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;!-- ul&gt;li.item$*3 --&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">    &lt;li class=&quot;item1&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item2&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;!-- ul&gt;li.item$@3*3 --&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">    &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item4&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item5&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;!-- ul&gt;li.item$@-*3 --&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">    &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item2&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item1&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;!-- ul&gt;li.item$@-3*3 --&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">    &lt;li class=&quot;item5&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item4&quot;&gt;&lt;/li&gt;</div><div class="line">    &lt;li class=&quot;item3&quot;&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<p><code>&gt;</code>如ul&gt;li — 子元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;ul&gt;</div><div class="line">    &lt;li&gt;&lt;/li&gt;</div><div class="line">&lt;/ul&gt;</div></pre></td></tr></table></figure></p>
<p><code>*</code>如li*3 —- 指定个数的元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;li&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;&lt;/li&gt;</div><div class="line">&lt;li&gt;&lt;/li&gt;</div></pre></td></tr></table></figure></p>
<p><code>+</code>如div+div —- 兄弟元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;&lt;/div&gt;</div><div class="line">&lt;div&gt;&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p><code>^</code>如div+div&gt;p&gt;span+em^bq —- 上级元素，多个表示向上几级<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;&lt;/div&gt;</div><div class="line">&lt;div&gt;</div><div class="line">    &lt;p&gt;&lt;span&gt;&lt;/span&gt;&lt;em&gt;&lt;/em&gt;&lt;/p&gt;</div><div class="line">    &lt;blockquote&gt;&lt;/blockquote&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p><code>()</code>如div&gt;(header&gt;ul&gt;li*3)+section+footer —- 群组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;</div><div class="line">    &lt;header&gt;</div><div class="line">        &lt;ul&gt;</div><div class="line">            &lt;li&gt;&lt;/li&gt;</div><div class="line">            &lt;li&gt;&lt;/li&gt;</div><div class="line">            &lt;li&gt;&lt;/li&gt;</div><div class="line">        &lt;/ul&gt;</div><div class="line">    &lt;/header&gt;</div><div class="line">    &lt;section&gt;&lt;/section&gt;</div><div class="line">    &lt;footer&gt;&lt;/footer&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<h3 id="CSS基本用法"><a href="#CSS基本用法" class="headerlink" title="CSS基本用法"></a>CSS基本用法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">div &#123;</div><div class="line">    &lt;!-- m:20 --&gt;</div><div class="line">    margin: 20px;</div><div class="line">    &lt;!-- mt:20 mb、ml、mr同理 --&gt;</div><div class="line">    margin-top: 20px;</div><div class="line">    &lt;!-- m:20-30 --&gt;</div><div class="line">    margin: 20px 30px;</div><div class="line">    &lt;!-- pos:a --&gt;</div><div class="line">    position: absolute;</div><div class="line">    &lt;!-- fl:l --&gt;</div><div class="line">    float: left;</div><div class="line">    &lt;!-- bd+ --&gt;</div><div class="line">    border: 1px solid #000;</div><div class="line">    &lt;!-- bdrs:3 --&gt;</div><div class="line">    border-radius: 3px;</div><div class="line">    &lt;!-- -wmso-bdrs:3 --&gt;</div><div class="line">    -webkit-border-radius: 3px;</div><div class="line">    -moz-border-radius: 3px;</div><div class="line">    -ms-border-radius: 3px;</div><div class="line">    -o-border-radius: 3px;</div><div class="line">    border-radius: 3px;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/05/javascript-base2/" itemprop="url">
                  JavaScript-基础2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-05T17:52:50+08:00" content="2017-07-05">
              2017-07-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近参加了一次为时两天的 JavaScript 培训，回顾课程内容并进行整理，其中参考了如下两篇老师的文章。</p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzIxMjE4NzM5MA==&amp;mid=2651782757&amp;idx=2&amp;sn=f7434ba3ed5f2e78eabb4f307f15f4ef&amp;chksm=8cb3bff4bbc436e2cab4f5df12988ee01d52723b640612c6830b15b292ec2b23accc932db7ca#rd" target="_blank" rel="external">JavaScript 编程技法入门</a><br><a href="http://mp.weixin.qq.com/s/suTn-IpXzPXHvw1OZQso7w" target="_blank" rel="external">JS 编程道场</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>函数是第一等公民。<br>JavaScript 的核心是 函数 和 对象 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typeof</span> <span class="built_in">Number</span> <span class="comment">// 'function'</span></div><div class="line"><span class="keyword">typeof</span> <span class="built_in">String</span> <span class="comment">// 'function'</span></div><div class="line"><span class="keyword">typeof</span> <span class="built_in">Function</span> <span class="comment">// 'function'</span></div></pre></td></tr></table></figure>
<h2 id="简化版-jquery-选择器实现"><a href="#简化版-jquery-选择器实现" class="headerlink" title="简化版 jquery 选择器实现"></a>简化版 jquery 选择器实现</h2><p>通过对 javascript 原生操作的封装，实现简化版的 jquery 类库。这里的代码并不复杂，个人感觉主要是要有类库的概念和实现思路，考虑将项目中使用的工具类逐步封装成类库。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> domObj = <span class="built_in">document</span>.querySelector(selector);</div><div class="line">    <span class="keyword">var</span> result = &#123;</div><div class="line">        <span class="string">'0'</span>: domObj,</div><div class="line">        show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; domObj.style.display = <span class="string">'none'</span>; &#125;,</div><div class="line">        hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; domObj.style.display = <span class="string">'block'</span>; &#125;,</div><div class="line">        append: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</div><div class="line">            domObj.innerHTML += str;</div><div class="line">        &#125;,</div><div class="line">        val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span> (value === <span class="literal">undefined</span>) &#123;</div><div class="line">                <span class="keyword">return</span> domObj.value;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                domObj.value = value;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        on: <span class="function"><span class="keyword">function</span>(<span class="params">action, callback</span>) </span>&#123;</div><div class="line">            <span class="comment">// 特定浏览器，这里是针对Chrome的写法</span></div><div class="line">            <span class="keyword">if</span> (domObj.addEventListener) &#123;</div><div class="line">                domObj.addEventListener(action, callback);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>js 是解释型动态语言，可随时添加属性或方法，很灵活。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj1 = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line">obj1.name = <span class="string">'object1'</span>;</div><div class="line">obj1.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>推荐使用如下字面量形式的定义方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj2 = &#123;</div><div class="line">    name: <span class="string">'object2'</span>,</div><div class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>遍历对象的属性和方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj2) &#123;</div><div class="line">    <span class="built_in">console</span>.log(key + <span class="string">'='</span> + obj2[key]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数的三种定义方式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 匿名函数，通过一个变量来指向一个匿名函数，当这个函数不再需要时，JS的运行时环境会自动收集内存垃圾</span></div><div class="line"><span class="keyword">var</span> func1 = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'hello,'</span> + name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 具名函数，有变量提升，也就是在这段代码的前面是可以调用func2方法的</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func2</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'hello,'</span> + name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 函数对象，这也表明了函数其实是Function类型的对象</span></div><div class="line"><span class="keyword">var</span> func3 = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'name'</span>, <span class="string">'return "hello," + name'</span>);</div></pre></td></tr></table></figure>
<p>函数体的内部只有在函数被调用时才会进入，下面 demo 的运行结果是先后输出 1、2、3、4、5。使用 Chrome 调试断点进入时，打开 Sources 注意观察 Scope 的变化，可以看到运行到 func1()时 Scope 只有 Globle，当进入到调用的方法时，会有 Local，里面是函数内部定义的变量或方法，当函数内部用到了外面的变量时，会有 Closure，里面是引用的外部变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line"><span class="keyword">var</span> func1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="comment">// 进来之后有Local</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">    <span class="keyword">var</span> a = <span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 进来之后有Closure</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="number">5</span>);</div><div class="line">        <span class="keyword">var</span> f = a + <span class="number">5</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</div><div class="line">    func2();</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line"><span class="keyword">debugger</span>;</div><div class="line">func1(); <span class="comment">// 这时只有Global</span></div></pre></td></tr></table></figure>
<img src="/2017/07/05/javascript-base2/运行顺序.png" width="400" title="运行顺序">
<img src="/2017/07/05/javascript-base2/调试.gif" title="Chrome调试">
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>this 取决于在哪调用，而不是在哪定义，通过“对象.”调用的，this 都是这个对象，直接调用的 this 都是 window。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line">func(<span class="string">'jobs'</span>); <span class="comment">// 进入func，this是window</span></div><div class="line"><span class="keyword">var</span> o = &#123;</div><div class="line">    setName: func</div><div class="line">&#125;;</div><div class="line">o.setName(<span class="string">'jobs'</span>); <span class="comment">// 进入func，this是o</span></div><div class="line"><span class="keyword">var</span> method = o.setName;</div><div class="line">method(<span class="string">'jobs'</span>); <span class="comment">// 进入func，this是window</span></div><div class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> func(<span class="string">'jobs'</span>);<span class="comment">// 进入func，this是obj</span></div></pre></td></tr></table></figure>
<p>通过函数的 call、apply、bind 方法进行调用可改变作用域，call 和 apply 只是传递参数的方式不同。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line">func.call(o, <span class="string">'jobs'</span>); <span class="comment">// 绑定作用域为o</span></div><div class="line">func.apply(o, [<span class="string">'jobs'</span>]);</div><div class="line">func.bind(o)(<span class="string">'jobs'</span>);</div></pre></td></tr></table></figure>
<h2 id="模拟类"><a href="#模拟类" class="headerlink" title="模拟类"></a>模拟类</h2><p>函数名的第一个字母大写，表示是用来构造对象的，不是用来执行的。</p>
<p>用方式一模拟类，o1 和 o2 有自己的 name 属性，但第三个输出结果为 false，这说明 o1.sayHello 和 o2.sayHello 指向不同内存，这样存在内存的浪费。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式一</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> o1 = &#123;&#125;, o2 = &#123;&#125;;</div><div class="line">Person.call(o1, <span class="string">'jobs'</span>);</div><div class="line">Person.call(o2, <span class="string">'gates'</span>);</div><div class="line"><span class="built_in">console</span>.log(o1.name); <span class="comment">// 输出jobs</span></div><div class="line"><span class="built_in">console</span>.log(o2.name); <span class="comment">// 输出gates</span></div><div class="line"><span class="built_in">console</span>.log(o1.sayHello === o2.sayHello); <span class="comment">// 输出false</span></div></pre></td></tr></table></figure>
<p>用方式一模拟类，第三个输出结果为 true，这时不存在内存浪费了，但破坏了封装，在外部也可以调用 sayHello 方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式二</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.sayHello = sayHello;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> o1 = &#123;&#125;, o2 = &#123;&#125;;</div><div class="line">Person.call(o1, <span class="string">'jobs'</span>);</div><div class="line">Person.call(o2, <span class="string">'gates'</span>);</div><div class="line"><span class="built_in">console</span>.log(o1.name); <span class="comment">// 输出jobs</span></div><div class="line"><span class="built_in">console</span>.log(o2.name); <span class="comment">// 输出gates</span></div><div class="line"><span class="built_in">console</span>.log(o1.sayHello === o2.sayHello); <span class="comment">// 输出true</span></div></pre></td></tr></table></figure>
<p>用方式三模拟类，通过即时函数封装作用域后，可以比较好的模拟类了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式三</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// private，在外部无法直接调用</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">    <span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.sayHello = sayHello;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// public</span></div><div class="line">    <span class="keyword">return</span> Person;</div><div class="line">&#125;(); <span class="comment">// 即时函数，封装作用域</span></div><div class="line"><span class="keyword">var</span> o1 = &#123;&#125;, o2 = &#123;&#125;;</div><div class="line">Person.call(o1, <span class="string">'jobs'</span>);</div><div class="line">Person.call(o2, <span class="string">'gates'</span>);</div><div class="line"><span class="built_in">console</span>.log(o1.sayHello === o2.sayHello); <span class="comment">// 输出true</span></div></pre></td></tr></table></figure>
<p>用方式四模拟类，在即时函数封装作用域的基础上，又添加了命名空间。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式四</span></div><div class="line"><span class="comment">// 模仿命名空间，可封装类库给别人使用</span></div><div class="line"><span class="keyword">var</span> cplh = cplh || &#123;&#125;;</div><div class="line"><span class="comment">// 模仿封装</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">g</span>) </span>&#123;</div><div class="line">    <span class="comment">// 模仿private，没有加到Person上</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">    <span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.sayHello = sayHello;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 模仿public</span></div><div class="line">    g.Person = Person;</div><div class="line">&#125;)(cplh); <span class="comment">// 加上括号来说明这是一个表达式</span></div><div class="line"><span class="comment">// 模仿初始化</span></div><div class="line"><span class="keyword">var</span> o1 = &#123;&#125;, o2 = &#123;&#125;;</div><div class="line">cplh.Person.call(o1, <span class="string">'jobs'</span>);</div><div class="line">cplh.Person.call(o2, <span class="string">'gates'</span>);</div><div class="line"><span class="built_in">console</span>.log(o1.sayHello === o2.sayHello); <span class="comment">// 输出true</span></div></pre></td></tr></table></figure>
<h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><p>所有对象都有原型对象<code>__proto__</code>，只有函数对象有原型属性<code>prototype</code>，当这个函数被用作构造函数来创建实例时，该函数的原型属性(prototype)将被作为原型赋值给所有对象实例，也就达到了重用方法的作用，<strong>即所有实例的原型引用的是函数的原型属性</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i = <span class="number">5</span>;</div><div class="line"><span class="keyword">var</span> str = <span class="string">'abc'</span>;</div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</div><div class="line"><span class="comment">// 所有对象都有原型对象</span></div><div class="line">i.__proto__ <span class="comment">// 有 [Number: 0]</span></div><div class="line">str.__proto__ <span class="comment">// 有 [String: '']</span></div><div class="line">Person.__proto__ <span class="comment">// 有 [Function]</span></div><div class="line"><span class="comment">// 只有函数对象有原型属性</span></div><div class="line">i.prototype <span class="comment">// undefined</span></div><div class="line">str.prototype <span class="comment">// undefined</span></div><div class="line">Person.prototype <span class="comment">// 有 [Object]</span></div><div class="line"><span class="comment">// 所有实例的原型引用的是函数的原型属性</span></div><div class="line"><span class="built_in">console</span>.log(i.__proto__ === <span class="built_in">Number</span>.prototype) <span class="comment">// 输出true</span></div><div class="line"><span class="built_in">console</span>.log(str.__proto__ === <span class="built_in">String</span>.prototype) <span class="comment">// 输出true</span></div><div class="line"><span class="built_in">console</span>.log(person.__proto__ === Person.prototype) <span class="comment">// 输出true</span></div></pre></td></tr></table></figure>
<p>在执行完 <code>var Person = function() {};</code> 语句时，会分配三块内存，Person 变量的内存、function 函数的内存、protptype 指向对象的内存，这个对象的 constructor 又指向 Person 指向的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"><span class="built_in">console</span>.log(Person);</div><div class="line"><span class="built_in">console</span>.log(Person.prototype); <span class="comment">// 输出一个Object，有constructor属性</span></div><div class="line"><span class="built_in">console</span>.log(Person.prototype.constructor === Person); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<img src="/2017/07/05/javascript-base2/内存.png" title="内存">
<p>JavaScript 是动态语言，取决于运行时，不是定义时，因此下面的代码中示例一的对象 o 是有 sayHello 方法的。通过如示例二、示例三、示例四的方式给 Function、String、jquery 等全局函数的 prototype 添加方法来实现共有的新功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 示例一</span></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line">o.__proto__ = Person.prototype;</div><div class="line"><span class="built_in">console</span>.log(o <span class="keyword">instanceof</span> Person); <span class="comment">// 输出 true</span></div><div class="line">Person.prototype.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"><span class="built_in">console</span>.log(o.sayHello); <span class="comment">// 输出 function() &#123;&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 示例二</span></div><div class="line"><span class="built_in">Function</span>.prototype.method = <span class="function"><span class="keyword">function</span>(<span class="params">name,fn</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.prototype[name] = fn;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line">Person.method(<span class="string">'sayHello'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="keyword">return</span> <span class="string">'Hello,'</span> + <span class="keyword">this</span>.name;</div><div class="line">&#125;).method(<span class="string">'show'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="keyword">return</span> <span class="string">'show'</span>;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> jobs = <span class="keyword">new</span> Person(<span class="string">'jobs'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Hello,jobs'</span> === jobs.sayHello()); <span class="comment">// 输出 true</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'show'</span> === jobs.show()); <span class="comment">// 输出 true</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 示例三</span></div><div class="line"><span class="built_in">String</span>.prototype.fill = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">    <span class="comment">// var sql = "select * from " + this;</span></div><div class="line">    $.getJSON(<span class="string">'/'</span> + <span class="keyword">this</span>, <span class="literal">null</span> functon(json, textStatus)&#123;</div><div class="line">        <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(json);</div><div class="line">        $(id).append(data);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 给id为wellTable01的元素添加从wells表中或接口中查出的数据</span></div><div class="line"><span class="string">"wells"</span>.fill(<span class="string">'#wellTable01'</span>);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 示例四</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> myMethod = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'自定义方法'</span>);</div><div class="line">    &#125;;</div><div class="line">    $.prototype.myMethod = myMethod;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<h3 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h3><p>利用原型实现类，注意下面方式一到方式四的区别，方式一到方式三的 o 对象已经有了 sayHello 方法，达到了重用方法的目的，但使用了<code>__proto__</code>，理论上 JavaScript 中是不让用的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式一</span></div><div class="line"><span class="comment">// 构造函数</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 方法体</span></div><div class="line"><span class="keyword">var</span> proto = &#123;</div><div class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 创建对象</span></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line"><span class="comment">// 赋值方法</span></div><div class="line">o.__proto__ = proto;</div><div class="line"><span class="comment">// 初始化</span></div><div class="line">Person.call(o, <span class="string">'jobs'</span>);</div><div class="line"><span class="built_in">console</span>.log(o.sayHello);</div></pre></td></tr></table></figure>
<p>方式二只是将 proto 作为 Person 的属性使用的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式二</span></div><div class="line"><span class="comment">// 构造函数</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 方法体</span></div><div class="line">Person.proto = &#123;</div><div class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 创建对象</span></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line"><span class="comment">// 赋值方法</span></div><div class="line">o.__proto__ = Person.proto;</div><div class="line"><span class="comment">// 初始化</span></div><div class="line">Person.call(o, <span class="string">'jobs'</span>);</div><div class="line"><span class="built_in">console</span>.log(o.sayHello);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式三</span></div><div class="line"><span class="comment">// 构造函数</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 方法体</span></div><div class="line">Person.prototype = &#123;</div><div class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 创建对象</span></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line"><span class="comment">// 赋值方法</span></div><div class="line">o.__proto__ = Person.prototype;</div><div class="line"><span class="comment">// 初始化</span></div><div class="line">Person.call(o, <span class="string">'jobs'</span>);</div><div class="line"><span class="built_in">console</span>.log(o.sayHello);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 方式四</span></div><div class="line"><span class="comment">// 构造函数</span></div><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">&#125;;</div><div class="line"><span class="comment">// 方法体</span></div><div class="line">Person.prototype = &#123;</div><div class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> Person(<span class="string">'jobs'</span>);</div><div class="line"><span class="built_in">console</span>.log(Person.prototype.sayHello);</div></pre></td></tr></table></figure>
<p>方式四使用 new 创建的对象，也就是说函数 Person 被用作构造函数来创建实例了，这时该函数 prototype 将被作为原型<code>__proto__</code>赋值给对象的实例，也就相当于如下代码。注意当函数名的第一个字母大写时，表示是用来构造对象的，不是用来执行的，该函数的 prototype 是给构造出来的对象用的，函数自己用不了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// var o = new Person('jobs'); 等同于以下代码</span></div><div class="line"><span class="comment">// 创建对象</span></div><div class="line"><span class="keyword">var</span> o = &#123;&#125;;</div><div class="line"><span class="comment">// 赋值方法</span></div><div class="line">o.__proto__ = Person.prototype;</div><div class="line"><span class="comment">// 初始化</span></div><div class="line">Person.call(o, <span class="string">'jobs'</span>);</div></pre></td></tr></table></figure>
<p>当定义一个当函数被用作构造函时，这个函数会默认在函数体开头和结尾添加如下代码，如果函数 return 的不是对象，在使用 new 实例化对象时这个 return 语句会被忽略，因为需要返回一个对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 默认添加</span></div><div class="line">    <span class="keyword">var</span> <span class="keyword">this</span> = &#123;&#125;;</div><div class="line">    ...</div><div class="line">    <span class="comment">// 会被忽略，因为需要返回对象</span></div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    ...</div><div class="line">    <span class="comment">// 默认添加</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现继承"><a href="#实现继承" class="headerlink" title="实现继承"></a>实现继承</h3><p>封装自己的框架，要有类、方法、复用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> Klass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">// 如果Class有初始化</span></div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">this</span>.initialize === <span class="string">'function'</span>)&#123;</div><div class="line">            <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> attr <span class="keyword">in</span> options) &#123;</div><div class="line">        Klass.prototype[attr] = options[attr];</div><div class="line">    &#125;</div><div class="line">    Klass.extends = <span class="function"><span class="keyword">function</span>(<span class="params">proto</span>) </span>&#123;</div><div class="line">        <span class="comment">// 定义子类</span></div><div class="line">        <span class="keyword">var</span> Child = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            Klass.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="comment">// var f = &#123;&#125;;</span></div><div class="line">        <span class="comment">// f.__proto__ = this.prototype;</span></div><div class="line">        <span class="comment">// // 相当于上面的，不能使用__proto__</span></div><div class="line">        <span class="comment">// var f = new Klass();</span></div><div class="line"></div><div class="line">        <span class="comment">// Child.prototype = f;</span></div><div class="line"></div><div class="line">        <span class="comment">// 继承基类</span></div><div class="line">        <span class="comment">// 不能使用 Child.prototype = this.prototype; 这样extends添加的方法会影响到基类</span></div><div class="line">        <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">/*</span></div><div class="line">            这是定义F函数的原因，如果不显示定义constructor的指向，constructor将指向Object，通过constructor已经无法确定对象的类型了。</div><div class="line">            这样显示定义constructor属性的在实例中是可枚举的。</div><div class="line">            */</div><div class="line">            <span class="keyword">this</span>.constructor = Child;</div><div class="line">        &#125;;</div><div class="line">        F.prototype = <span class="keyword">this</span>.prototype;<span class="comment">// 继承</span></div><div class="line">        <span class="keyword">var</span> f = <span class="keyword">new</span> F();</div><div class="line">        Child.prototype = f;</div><div class="line"></div><div class="line">        <span class="comment">// 类的实例方法</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> attr2 <span class="keyword">in</span> proto) &#123;</div><div class="line">            Child.prototype[attr2] = proto[attr2];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Child;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> Klass;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 方式一</span></div><div class="line"><span class="keyword">var</span> Person1 = <span class="keyword">new</span> Class();<span class="comment">// 函数对象可以执行</span></div><div class="line"><span class="keyword">var</span> jobs1 = <span class="keyword">new</span> Person();</div><div class="line"><span class="comment">// 方式二</span></div><div class="line"><span class="keyword">var</span> Person2 = <span class="keyword">new</span> Class(&#123;</div><div class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> jobs2 = <span class="keyword">new</span> Person();</div><div class="line"><span class="comment">// 方式三</span></div><div class="line"><span class="keyword">var</span> Person3 = <span class="keyword">new</span> Class(&#123;</div><div class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> Actor = Person3.extends(&#123;</div><div class="line">    sayHello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> jobs3 = <span class="keyword">new</span> Actor();</div></pre></td></tr></table></figure>
<img src="/2017/07/05/javascript-base2/继承.png" title="我对继承的理解">
<p>封装商业框架，有 Model 和 View。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> Adobe = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> Model = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">    <span class="comment">// 实例方法</span></div><div class="line">    Model.prototype = &#123;</div><div class="line">        <span class="keyword">constructor</span>: Model,</div><div class="line">        get: function() &#123;&#125;,</div><div class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 绑定作用域，在context作用域上执行func函数</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">proxy</span> (<span class="params">func, context</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            func.apply(context, <span class="built_in">arguments</span>);</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> View = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">//Hack: 绑定事件，这段代码不明白</span></div><div class="line">        <span class="keyword">var</span> events = <span class="keyword">this</span>.events || &#123;&#125;;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> item <span class="keyword">in</span> events)&#123;</div><div class="line">            <span class="keyword">var</span> func = proxy(<span class="keyword">this</span>[events[item]], <span class="keyword">this</span>);</div><div class="line">            <span class="keyword">var</span> reg = <span class="regexp">/(.+)\s+(.+)/</span>;</div><div class="line">            <span class="keyword">var</span> result = reg.exec(item);</div><div class="line">            $(result[<span class="number">2</span>]).bind(result[<span class="number">1</span>], func);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    View.extend = Model.extend = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> Parent = <span class="keyword">this</span>;</div><div class="line">        <span class="comment">// 构造函数</span></div><div class="line">        <span class="keyword">var</span> Klass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="keyword">this</span>.initialize === <span class="string">'function'</span>)&#123;</div><div class="line">                <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">            &#125;</div><div class="line">            Parent.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// 继承</span></div><div class="line">        <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.constructor = Klass;</div><div class="line">        &#125;;</div><div class="line">        F.prototype = <span class="keyword">this</span>.prototype;</div><div class="line">        Klass.prototype = <span class="keyword">new</span> F();</div><div class="line">        Klass.prototype.__super__ = <span class="keyword">this</span>.prototype;</div><div class="line">        <span class="comment">// 扩展</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> options)&#123;</div><div class="line">            Klass.prototype[name] = options[name];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Klass;</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        Model: Model,</div><div class="line">        View: View</div><div class="line">    &#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line"><span class="comment">// 使用代码</span></div><div class="line"><span class="keyword">var</span> Todo = Adobe.Model.extend(&#123;</div><div class="line">    initialize: <span class="function"><span class="keyword">function</span>(<span class="params">title</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> title === <span class="string">'string'</span>)&#123;</div><div class="line">            <span class="keyword">this</span>.set(&#123;title: title&#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> todo = <span class="keyword">new</span> Todo(<span class="string">'Test'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> todo.get === <span class="string">'function'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> todo.set === <span class="string">'function'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> todo.initialize === <span class="string">'function'</span>);</div></pre></td></tr></table></figure>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line"><span class="keyword">var</span> f = <span class="keyword">new</span> fun();</div><div class="line"></div><div class="line">f.__proto__; <span class="comment">// fun.prototype</span></div><div class="line">f.__proto__.__proto__; <span class="comment">// Object.prototype</span></div><div class="line">f.__proto__.__proto__.__proto__; <span class="comment">// null</span></div><div class="line">f.__proto__.__proto__.__proto__.__proto__; <span class="comment">// 报错</span></div><div class="line">fun.__proto__; <span class="comment">// Function.prototype</span></div><div class="line">fun.__proto__.__proto__; <span class="comment">// Object.prototype</span></div><div class="line">f.prototype; <span class="comment">// undefined</span></div><div class="line">fun.prototype; <span class="comment">// &#123; constructor: fun &#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</div><div class="line">  a = <span class="number">1</span>;</div><div class="line">  m1() &#123;&#125;</div><div class="line">  m2 = () =&gt; &#123;&#125;;</div><div class="line">  <span class="keyword">static</span> s2 = <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 等同写法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.a = <span class="number">1</span>;</div><div class="line">  <span class="keyword">this</span>.m2 = () =&gt; &#123;&#125;;</div><div class="line">&#125;</div><div class="line">Demo.prototype.m1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">Demo.s2 = <span class="number">2</span>;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/03/react-native-BackAndroid/" itemprop="url">
                  React-Native-BackAndroid
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-03T11:05:00+08:00" content="2017-07-03">
              2017-07-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="BackAndroid-物理返回键的使用"><a href="#BackAndroid-物理返回键的使用" class="headerlink" title="BackAndroid 物理返回键的使用"></a>BackAndroid 物理返回键的使用</h2><p>在android上，点击物理返回键时，通常会进行返回上个页面的操作，如果已经回到主页、没有上一级页面，则会弹出是否退出应用的提示。在RN中，对物理返回键的监听尽量放在最上层的组件中，示例代码如下。如果哪个页面单独定义了点击返会的操作，如给出提示是否保存当前页面，可在这个组件中再进行物理返回键的监听，注意最后要return true，这样就不会进入到全局的监听方法了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">import &#123;</div><div class="line">  ...</div><div class="line">  Platform,</div><div class="line">  BackAndroid,</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line"></div><div class="line">class App extends Component &#123;</div><div class="line">  constructor(props)&#123;</div><div class="line">    super(props);</div><div class="line">  &#125;</div><div class="line">  componentWillMount() &#123;</div><div class="line">    if (Platform.OS === &apos;android&apos;) &#123;</div><div class="line">      BackAndroid.addEventListener(&apos;hardwareBackPress&apos;, this.onBackAndroid);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  componentWillUnmount() &#123;</div><div class="line">    if (Platform.OS === &apos;android&apos;) &#123;</div><div class="line">      BackAndroid.removeEventListener(&apos;hardwareBackPress&apos;, this.onBackAndroid);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  onBackAndroid = () =&gt; &#123;</div><div class="line">    const navigator = this.refs.navigator;</div><div class="line">    const routers = navigator.getCurrentRoutes();</div><div class="line">    if (routers.length &gt; 1) &#123;</div><div class="line">      navigator.pop(); // 没到主页，直接弹出到上一个页面</div><div class="line">      return true; // 接管默认行为</div><div class="line">    &#125; else &#123;</div><div class="line">      // 到了主页了，最近2秒内按过back键，退出应用；否则弹出提示</div><div class="line">      if (this.lastBackPressed &amp;&amp; this.lastBackPressed + 2000 &gt;= Date.now()) &#123;</div><div class="line">        return false;</div><div class="line">      &#125;</div><div class="line">      this.lastBackPressed = Date.now();</div><div class="line">      Toast.info(&apos;再按一次退出应用&apos;);</div><div class="line">      return true;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  render () &#123;</div><div class="line">    return (</div><div class="line">        &lt;Navigator</div><div class="line">            ref=&quot;navigator&quot;</div><div class="line">            initialRoute=&#123;initialRoute&#125;</div><div class="line">            shadowHidden=&#123;true&#125;</div><div class="line">            translucent=&#123;true&#125;</div><div class="line">            configureScene=&#123;this.configureScene&#125;</div><div class="line">            renderScene=&#123;this.renderScene&#125;</div><div class="line">          /&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/28/react-diff/" itemprop="url">
                  React-Diff算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-28T09:33:24+08:00" content="2017-06-28">
              2017-06-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React/" itemprop="url" rel="index">
                    <span itemprop="name">React</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Diff算法"><a href="#Diff算法" class="headerlink" title="Diff算法"></a>Diff算法</h2><p>React.js 相对于直接操作原生DOM有很大的性能优势，很大程度上都要归功于virtual DOM的batching和diff。batching把所有的DOM操作搜集起来，一次性提交给真实的DOM。diff算法时间复杂度也从标准的的Diff算法的O(n^3)降到了O(n)。React.js将标准的的Diff算法复杂度O(n^3)直接降低到O(n)基于的假设：</p>
<ul>
<li>两个相同组件产生类似的DOM结构，不同的组件产生不同的DOM结构</li>
<li>对于同一层次的一组子节点，它们可以通过唯一的id进行区分</li>
</ul>
<p>在比较两个React节点树时，React首先比较根元素，随后的行为取决于根元素类型：</p>
<ul>
<li>只要根节点类型不同，React就会销毁旧节点树，创建新节点树</li>
<li>当节点类型相同时，React比较两者的属性，不改变DOM节点，只更新当前节点需要改变的属性</li>
<li>如果节点需要更新样式属性，React仅会更新当前节点需要改变的样式属性</li>
</ul>
<p>React的Diff算法实际上只会对树进行逐层比较。在实现自己的组件时，保持稳定的DOM结构会有助于性能的提升。例如，我们有时可以通过CSS隐藏或显示某些节点，而不是真的移除或添加DOM节点。</p>
<img src="/2017/06/28/react-diff/传统算法O(n^3).png" title="传统Diff算法O(n^3)">
<img src="/2017/06/28/react-diff/React算法O(n).png" width="500" title="React Diff算法O(n)">
<h2 id="key属性在diff算法中的作用"><a href="#key属性在diff算法中的作用" class="headerlink" title="key属性在diff算法中的作用"></a>key属性在diff算法中的作用</h2><p>使用浏览器的MutationObserver的功能，对页面上元素的改变进行监听，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">    &lt;script src=&quot;react.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script src=&quot;react-dom.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt;</div><div class="line">    &lt;script src=&quot;babel.min.js&quot;&gt;&lt;/script&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;div id=&quot;container&quot;&gt;&lt;/div&gt;</div><div class="line">    &lt;style&gt;</div><div class="line"></div><div class="line">    &lt;/style&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;</div><div class="line">        var observeMutationSupport = !!MutationObserver;</div><div class="line">        var changedNodes = [];</div><div class="line">        if(observeMutationSupport) &#123;</div><div class="line">            var observer = new MutationObserver(function(mutations) &#123;</div><div class="line">                changedNodes = mutations;</div><div class="line">                mutations.forEach(function(mutation)&#123;</div><div class="line">                    console.log(mutation);</div><div class="line">                &#125;);</div><div class="line">            &#125;);</div><div class="line">            var options = &#123;</div><div class="line">                &apos;childList&apos;: true, // 子节点的变动</div><div class="line">                &apos;attributes&apos;: true, // 属性的变动</div><div class="line">                &apos;characterData&apos;: true, // 节点内容或节点文本的变动</div><div class="line">                &apos;subtree&apos;: true, // 所有后代节点的变动</div><div class="line">                &apos;attributeOldValue&apos;: true, // 表示观察attributes变动时，是否需要记录变动前的属性值</div><div class="line">                &apos;characterDataOldValue&apos;: true // 表示观察characterData变动时，是否需要记录变动前的值</div><div class="line">            &#125;;</div><div class="line">            observer.observe(document.body, options);</div><div class="line">        &#125;</div><div class="line">    &lt;/script&gt;</div><div class="line">    &lt;script type=&quot;text/babel&quot;&gt;</div><div class="line">        function LifeCycle(name) &#123;</div><div class="line">            var obj = &#123;</div><div class="line">                name: name</div><div class="line">            &#125;;</div><div class="line">            for(var n in Cycle)&#123;</div><div class="line">                obj[n] = Cycle[n];</div><div class="line">            &#125;</div><div class="line">            return obj;</div><div class="line">        &#125;</div><div class="line">        var Cycle = &#123;</div><div class="line">            getInitialState: function() &#123;</div><div class="line">                console.log(this.name, &apos;getInitialState&apos;);</div><div class="line">                return &#123;&#125;;</div><div class="line">            &#125;,</div><div class="line">            getDefaultProps: function() &#123;</div><div class="line">                console.log(this.name, &apos;getDefaultProps&apos;);</div><div class="line">                return &#123;&#125;;</div><div class="line">            &#125;,</div><div class="line">            componentWillMount: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentWillMount&apos;);</div><div class="line">            &#125;,</div><div class="line">            componentDidMount: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentDidMount&apos;);</div><div class="line">            &#125;,</div><div class="line">            componentWillReceiveProps: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentWillReceiveProps&apos;);</div><div class="line">            &#125;,</div><div class="line">            shouldComponentUpdate: function() &#123;</div><div class="line">                console.log(this.name, &apos;shouldComponentUpdate&apos;);</div><div class="line">                return true;</div><div class="line">            &#125;,</div><div class="line">            componentWillUpdate: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentWillUpdate&apos;);</div><div class="line">            &#125;,</div><div class="line">            componentDidUpdate: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentDidUpdate&apos;);</div><div class="line">            &#125;,</div><div class="line">            componentWillUnmount: function() &#123;</div><div class="line">                console.log(this.name, &apos;componentWillUnmount&apos;);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        // 定义Ctrip组件</div><div class="line">        var Ctrip = React.createClass(&#123;</div><div class="line">            mixins: [LifeCycle(&apos;Ctrip&apos;)],</div><div class="line">            render: function() &#123;</div><div class="line">                console.log(&apos;Ctrip&apos;, &apos;render&apos;);</div><div class="line">                return (</div><div class="line">                    &lt;ul&gt;</div><div class="line">                        &lt;li&gt;ctrip&lt;/li&gt;</div><div class="line">                        &lt;li&gt;</div><div class="line">                            &lt;ul&gt;</div><div class="line">                                &#123;this.props.children&#125;</div><div class="line">                            &lt;/ul&gt;</div><div class="line">                        &lt;/li&gt;</div><div class="line">                    &lt;/ul&gt;</div><div class="line">                );</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        // 定义Elong组件</div><div class="line">        var Elong = React.createClass(&#123;</div><div class="line">            mixins: [LifeCycle(&apos;Elong&apos;)],</div><div class="line">            render: function() &#123;</div><div class="line">                console.log(&apos;Elong&apos;, &apos;render&apos;);</div><div class="line">                return (</div><div class="line">                    &lt;li&gt;elong&lt;/li&gt;</div><div class="line">                );</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        // 定义Qunar组件</div><div class="line">        var Qunar = React.createClass(&#123;</div><div class="line">            mixins: [LifeCycle(&apos;Qunar&apos;)],</div><div class="line">            render: function() &#123;</div><div class="line">                console.log(&apos;Qunar&apos;, &apos;render&apos;);</div><div class="line">                return (</div><div class="line">                    &lt;li&gt;qunar&lt;/li&gt;</div><div class="line">                );</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        // 定义Ly组件</div><div class="line">        var Ly = React.createClass(&#123;</div><div class="line">            mixins: [LifeCycle(&apos;Ly&apos;)],</div><div class="line">            render: function () &#123;</div><div class="line">                console.log(&apos;Ly&apos;, &apos;render&apos;);</div><div class="line">                return (</div><div class="line">                    &lt;li&gt;ly&lt;/li&gt;</div><div class="line">                );</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        console.log(&apos;------------first------------&apos;);</div><div class="line">        ReactDOM.render(</div><div class="line">            &lt;Ctrip&gt;&lt;Elong&gt;&lt;/Elong&gt;&lt;Qunar&gt;&lt;/Qunar&gt;&lt;/Ctrip&gt;,</div><div class="line">            document.getElementById(&apos;container&apos;)</div><div class="line">        );</div><div class="line">        setTimeout(function() &#123;</div><div class="line">            console.log(&apos;------------second------------&apos;);</div><div class="line">            ReactDOM.render(</div><div class="line">                &lt;Ctrip&gt;&lt;Elong&gt;&lt;/Elong&gt;&lt;Ly&gt;&lt;/Ly&gt;&lt;Qunar&gt;&lt;/Qunar&gt;&lt;/Ctrip&gt;,</div><div class="line">                document.getElementById(&apos;container&apos;)</div><div class="line">            );</div><div class="line">        &#125;, 1000);</div><div class="line">    &lt;/script&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<img src="/2017/06/28/react-diff/withoutKey.png" title="运行结果如图">
<p>常规的做法就是将Elong和Qunar组件先删除，然后一次创建和插入Elong、Ly和Qunar组件。通过运行结果可以看出，在React中，Elong组件不变，先将Qunar组件进行删除，然后在创建并插入Ly组件，最后再创建并插入Qunar组件，比常规的做法省去了对Elong组件的删除操作。下面再将主逻辑代码稍作调整，给每个组件添加key属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">console.log(&apos;------------first------------&apos;);</div><div class="line">ReactDOM.render(</div><div class="line">    &lt;Ctrip&gt;&lt;Elong key=&quot;Elong&quot;&gt;&lt;/Elong&gt;&lt;Qunar key=&quot;Qunar&quot;&gt;&lt;/Qunar&gt;&lt;/Ctrip&gt;,</div><div class="line">    document.getElementById(&apos;container&apos;)</div><div class="line">);</div><div class="line">setTimeout(function() &#123;</div><div class="line">    console.log(&apos;------------second------------&apos;);</div><div class="line">    ReactDOM.render(</div><div class="line">        &lt;Ctrip&gt;&lt;Elong key=&quot;Elong&quot;&gt;&lt;/Elong&gt;&lt;Ly key=&quot;Ly&quot;&gt;&lt;/Ly&gt;&lt;Qunar key=&quot;Qunar&quot;&gt;&lt;/Qunar&gt;&lt;/Ctrip&gt;,</div><div class="line">        document.getElementById(&apos;container&apos;)</div><div class="line">    );</div><div class="line">&#125;, 1000);</div><div class="line">...</div></pre></td></tr></table></figure>
<img src="/2017/06/28/react-diff/withKey.png" title="运行结果如图">
<p>这次的Diff算法与之前有很大不同，Elong组件不变，Qunar组件不变，只是在Qunar组件之前创建并插入了Ly组件。可见使用key属性可提高渲染性能。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/20/redux-saga-base1/" itemprop="url">
                  Redux-saga-基础(未完成)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-20T11:36:03+08:00" content="2017-06-20">
              2017-06-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Redux/" itemprop="url" rel="index">
                    <span itemprop="name">Redux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考<br><a href="http://leonshi.com/redux-saga-in-chinese/index.html" target="_blank" rel="external">Redux-saga 中文文档</a><br><a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="external">redux-saga</a><br><a href="https://github.com/redux-saga/redux-saga-beginner-tutorial" target="_blank" rel="external">redux-saga-beginner-tutorial</a> 有点简单<br><a href="https://github.com/kuy/redux-saga-chat-example" target="_blank" rel="external">redux-saga-chat-example</a> 有点复杂<br><a href="https://github.com/kuy/redux-saga-examples" target="_blank" rel="external">redux-saga-examples</a> 有好几个例子</p>
<h2 id="Redux-saga简介"><a href="#Redux-saga简介" class="headerlink" title="Redux-saga简介"></a>Redux-saga简介</h2><p>redux-saga 是一个用于管理 Redux 应用异步操作的中间件。Sagas 是通过 Generator 函数来创建的，因为使用了 Generator，redux-saga 让你可以用同步的方式写异步代码。</p>
<p>Sagas 不同于 Thunks，Thunks 是在 action 被创建时调用，而 Sagas 只会在应用启动时调用（但初始启动的 Sagas 可能会动态调用其他 Sagas）。 Sagas 可以被看作是在后台运行的进程。<strong>Sagas 监听发起的 action，然后决定基于这个 action 来做什么：是发起一个异步调用（比如一个 Ajax 请求），还是发起其他的 action 到 Store，甚至是调用其他的 Sagas。</strong></p>
<p>在 redux-saga 的世界里，所有的任务都通用 yield Effects 来完成（译注：Effect 可以看作是 redux-saga 的任务单元）。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>当 Saga 启动了（不管是初始启动或是稍后动态启动），middleware 会自动将它的 take / put 连接至 store。 这 2 个 Effect 可以被看作是一种 Saga 的输入/输出（Input/Output）。</p>
<p><strong>call</strong></p>
<p>call 创建了一条描述结果的信息，不立即执行异步调用，还有apply，像js的call和apply，也可以使用 call Effect 进行同步调用，call 不仅可以用来调用返回 Promise 的函数。我们也可以用它来调用其他 Generator 函数，同步的<br>call 和 apply 非常适合返回 Promise 结果的函数</p>
<p><strong>cps</strong></p>
<p>cps 可以用来处理 Node 风格的函数，表示的是延续传递风格</p>
<p><strong>take</strong></p>
<p>take 就像 call 和 put，它创建另一个命令对象，告诉 middleware 等待一个特定的 action，它将会暂停 Generator 直到一个匹配的 action 被发起了</p>
<p><strong>fork</strong></p>
<p>fork 任务会在后台启动，调用者也可以继续它自己的流程，而不用等待被 fork 的任务结束，异步的</p>
<p><strong>cancel</strong></p>
<p> 如果任务仍在运行，它会被中止，如果任务已完成，那什么也不会发生。一旦任务被 fork，可以使用 yield cancel(task) 来中止任务执行。取消正在运行的任务，将抛出 SagaCancellationException 错误。未被捕获的 SagaCancellationException 不会向上冒泡。yield cancel(task) 不会等待被取消的任务完成（即执行其 catch 区块）。<br>  /<em><br>  const [users, repos] = yield [<br>    call(fetch, ‘/users’),<br>    call(fetch, ‘/repos’)<br>  ];<br>  generator 会被阻塞直到所有的 effects 都执行完毕，或者当一个 effect 被拒绝 （就像 Promise.all 的行为）
  </em>/</p>
<p><strong>race</strong></p>
<p> race 同时启动多个任务，但又不想等待所有任务完成，只希望拿到胜利者，即第一个被 resolve（或 reject）的任务；它会自动取消那些失败的 Effects<br>  yield call(delay, 1000)</p>
<p><strong>put</strong></p>
<p>put 这个函数用于创建 dispatch Effect</p>
<p>  使用 take 组织代码有一个小问题。在 takeEvery 的情况中，被调用的任务无法控制何时被调用， 它们将在每次 action 被匹配时一遍又一遍地被调用。并且它们也无法控制何时停止监听。<br>而在 take 的情况中，控制恰恰相反。与 action 被 推向（pushed） 任务处理函数不同，Saga 是自己主动 拉取（pulling） action 的。 看起来就像是 Saga 在执行一个普通的函数调用 action = getNextAction()，这个函数将在 action 被发起时 resolve。</p>
<p><strong>takeEvery</strong></p>
<p>takeEvery 在每个 action 来到时派生一个新的任务</p>
<p><strong>takeLatest</strong></p>
<p><strong>isCancelError</strong></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>使用redux-saga写todo</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/17/react-native-base3/" itemprop="url">
                  React-Native-基础3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-17T12:17:23+08:00" content="2017-06-17">
              2017-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>已经用react-native开发过3个项目，经过这段时间的使用，对react-native总结如下。</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li>个人感觉react-native的主要优点还是快速构建页面，无论是使用antd-mobile的组件库还是使用react-native官方提供的组件，都能相对快速的搭建页面，但是，无论使用哪种方式也都存在着同一个问题，就是样式问题，如果要完全按照UI设计做出一套页面，还是不太容易。</li>
<li>个人感觉react-native在页面交互上还是比较方便的，可以通过组件、组件提供的方法进行事件的控制，如页面跳转、点击、关联刷新等，目前很少发现有不支持的事件。</li>
<li>个人感觉，在android上开发的react-native项目，调试出一版ios的困难并不大，如果开发中使用的第三方依赖都是兼容ios的且不考虑ios适配问题，预计一周时间是可以调出一版兼容ios的。</li>
<li>开源的第三方组件比较多，目前使用过的第三方依赖可参考<a href="/2017/04/02/react-native-dependencies/">React-Native-依赖</a>，而且已经确认友盟、bugtags都可以支持react-native。</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><h3 id="项目名称修改不方便"><a href="#项目名称修改不方便" class="headerlink" title="项目名称修改不方便"></a>项目名称修改不方便</h3><p>react-native项目名称修改不方便，个人认为目前就是不能修改项目名称。使用react-native-cli初始化的项目，android目录和ios目录中都有很多地方使用了项目名称，不是修改根目录文件夹的名称就能修改项目名称的，因此如果想使用已有的稳定项目生成新的项目，只能先初始化一个新的项目，再手动移代码，很不方便。</p>
<p>目前已经试验过针对android的项目名称修改的方法，参见<a href="/2016/11/30/react-native-base/">React-Native-基础1</a>中“项目名称修改”部分，但针对ios的项目名称修改还没有找到解决办法，因此还不敢使用这种方法。</p>
<h3 id="不支持web端"><a href="#不支持web端" class="headerlink" title="不支持web端"></a>不支持web端</h3><p>直接使用react-native开发的项目，可以做到兼容android和ios，但不能运行在web端。react-native-web声称能将react-native开发的项目运行在web端，个人只试验过将直接初始化的项目运行在web端，但对于已经使用了很多第三方依赖的项目运行在web端报错了，想要将react-native开发的项目运行在web端不是那么容易的。京东是自己实现了从React Native向React JS进行转换的方案。</p>
<h3 id="开发中常见错误"><a href="#开发中常见错误" class="headerlink" title="开发中常见错误"></a>开发中常见错误</h3><p>开发中常见两个错误，截图如下，目前只在开发环境有，打包后的生产环境暂时还没发现。开发环境下OOM错误非常频繁，查找react-native在github上的<a href="https://github.com/facebook/react-native/issues/13379" target="_blank" rel="external">issues列表</a>建议将使用图片的ListView换成FlatList。</p>
<img src="/2017/06/17/react-native-base3/langPressIn.jpg" width="300" title="RESPONDER_ACTIVE_LONG_PRESS_IN错误">
<img src="/2017/06/17/react-native-base3/oom.png" width="300" title="OOM错误">
<h3 id="多个异步请求-redux-saga"><a href="#多个异步请求-redux-saga" class="headerlink" title="多个异步请求 redux-saga"></a>多个异步请求 redux-saga</h3><p>在业务逻辑比较复杂、需要多次网络请求及本地数据库操作的情况下，例如下面的业务，写出来的代码会很复杂，原因就是使用redux发起了多个异步action，除了图片上传，个人感觉应该是使用同步请求的逻辑会容易些，因为后面的处理是基于前一个请求结果进行的，但fetch没有同步请求方法，所以逻辑写起来就复杂些。目前已知的解决发起多个异步请求的方法有redux-sequence-action和redux-sage，redux-sequence-action在web端使用过，但感觉还是有些局限，redux-sage应该是比较好的解决方案，但目前还没研究过怎么使用。</p>
<p>“带有图片的本地数据进行web端提交后，无论提交是否成功，都需要进行本地保存；如果提交成功，根据请求返回结果删除本地业务数据、更新图片关系表，再将图片上传到web端，并根据图片上传成功的返回结果更新本地图片关系表。”</p>
<h3 id="打包耗时"><a href="#打包耗时" class="headerlink" title="打包耗时"></a>打包耗时</h3><p>打包问题，就像react-native项目有时需要很多次启动才能启动成功（最多一次启动了6、7次），打包通常也是需要多次，几乎没有一次就能打包成功的时候，这时候代码不能修改，只能干等，后期希望引入持续集成解决这个问题，也能解决使用不同机器打的包可能不一致的问题。</p>
<h3 id="其它问题"><a href="#其它问题" class="headerlink" title="其它问题"></a>其它问题</h3><ul>
<li>样式不好调整，如果要完全按照UI设计做出一套页面，还是不太容易，而且目前还做过屏幕适配，不知道好不好处理</li>
<li>react-native版本升级有时变动较大，如0.44去掉了Navigator和BackAndroid，最主要的是许多第三方依赖对高版本rn支持的不好</li>
<li>react-native或其它组件可能存在手机适配问题，目前发现的是在工程机“VT5000”上，ListView的Item如果包装了滑动删除，几乎无法触发Item的onPress事件</li>
<li>开发环境和打包后的生产环境可能不一致，具体原因还不清楚，怀疑是开发时打开浏览器调试能使用了一些浏览器的解析功能，导致离开浏览器的打包后的生产环境可能存在问题</li>
<li>数据库操作使用的<a href="https://github.com/andpor/react-native-sqlite-storage" target="_blank" rel="external">react-native-sqlite-storage</a>，个人感觉还是不太好用，多个查询的嵌套看上去很乱，写起来也不方便</li>
<li>本人没有做过原生开发，不了解更新升级，京东在GMTC会议演讲中提到更新升级需要依赖第三方框架，在我目前的项目中更新升级时本地库的处理还没有查找解决方案</li>
<li>Small等插件化框架是支持原生的，目前没有看到支持react-native的文档，有没有支持react-native插件化的框架还不清楚</li>
<li>复杂场景下内存性能有瓶颈，页面跳转可能卡顿，有些偶发问题很难复现也不好定位原因，目前发现的是ListView中数据重复的问题，还没定位原因</li>
<li>react-native项目运行时有时需要android studio先编译，这就需要保持开发人员android studio环境的一致，有时候我运行项目没问题，但其它人运行就有问题，需要打开android studio看一下编译信息</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/17/react-native-baidu-map-android/" itemprop="url">
                  React-Native-Android使用百度地图
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-17T11:31:13+08:00" content="2017-06-17">
              2017-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="百度地图key值"><a href="#百度地图key值" class="headerlink" title="百度地图key值"></a>百度地图key值</h2><ul>
<li><a href="http://developer.baidu.com/，注册开发者帐号" target="_blank" rel="external">http://developer.baidu.com/，注册开发者帐号</a></li>
<li>进入百度地图-&gt;API控制台，创建应用，应用类型选择Android SDK，输入发布版SHA1和包名提交即可</li>
</ul>
<img src="/2017/06/17/react-native-baidu-map-android/key.png" title="申请百度地图key">
<h2 id="显示地图及定位"><a href="#显示地图及定位" class="headerlink" title="显示地图及定位"></a>显示地图及定位</h2><p>使用<a href="https://github.com/lovebing/react-native-baidu-map" target="_blank" rel="external">react-native-baidu-map</a>依赖。</p>
<ul>
<li><p><code>NPM install</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install react-native-baidu-map --save</div></pre></td></tr></table></figure>
</li>
<li><p><code>android/setting.gradle</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">include &apos;:react-native-baidu-map&apos;</div><div class="line">project(&apos;:react-native-baidu-map&apos;).projectDir = new File(settingsDir, &apos;../node_modules/react-native-baidu-map/android&apos;)</div></pre></td></tr></table></figure>
</li>
<li><p><code>android/app/build.gradle</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile project(&apos;:react-native-baidu-map&apos;)</div></pre></td></tr></table></figure>
</li>
<li><p><code>MainApplication.java</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import org.lovebing.reactnative.baidumap.BaiduMapPackage;</div><div class="line"></div><div class="line">      return Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">          ...</div><div class="line">          , new BaiduMapPackage(getApplicationContext())</div><div class="line">          ...</div></pre></td></tr></table></figure>
</li>
<li><p><code>AndroidManifest.xml</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;!--用于进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--用于访问GPS定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--用于访问网络，网络定位需要上网--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--用于读取手机当前的状态--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;&gt;&lt;/uses-permission&gt;</div><div class="line">&lt;!--写入扩展存储，向扩展卡写入数据，用于写入缓存定位数据--&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;&gt;&lt;/uses-permission&gt;</div><div class="line"></div><div class="line">&lt;application</div><div class="line">  android:name=&quot;.MainApplication&quot;</div><div class="line">  android:allowBackup=&quot;true&quot;</div><div class="line">  android:label=&quot;@string/app_name&quot;</div><div class="line">  android:icon=&quot;@mipmap/ic_launcher&quot;</div><div class="line">  android:theme=&quot;@style/AppTheme&quot;&gt;</div><div class="line">  &lt;service android:name=&quot;com.amap.api.location.APSService&quot;&gt;&lt;/service&gt;</div><div class="line">  &lt;meta-data</div><div class="line">    android:name=&quot;com.baidu.lbsapi.API_KEY&quot;</div><div class="line">    android:value=&quot;baidu-key&quot;/&gt;&lt;!--百度地图key值--&gt;</div><div class="line">   ...</div></pre></td></tr></table></figure>
</li>
<li><p>Usage</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">  View,</div><div class="line">  Text,</div><div class="line">  TouchableHighlight,</div><div class="line">  StyleSheet,</div><div class="line">  InteractionManager,</div><div class="line">  Dimensions,</div><div class="line">  Platform,</div><div class="line">  StatusBar,</div><div class="line">  NativeAppEventEmitter,</div><div class="line">  Alert,</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">import &#123; Button &#125; from &apos;antd-mobile&apos;;</div><div class="line">import &#123; MapView, MapTypes, MapModule, Geolocation &#125; from &apos;react-native-baidu-map&apos;;</div><div class="line"></div><div class="line">class BaiduLocationTest extends Component &#123;</div><div class="line">  constructor(props) &#123;</div><div class="line">    super(props);</div><div class="line">    this.state = &#123;</div><div class="line">      mayType: MapTypes.NORMAL,</div><div class="line">      zoom: 15,</div><div class="line">      center: &#123;</div><div class="line">        longitude: 113.981718,</div><div class="line">        latitude: 22.542449</div><div class="line">      &#125;,</div><div class="line">      trafficEnabled: false,</div><div class="line">      baiduHeatMapEnabled: false,</div><div class="line">      markers: [&#123;</div><div class="line">        longitude: 113.981718,</div><div class="line">        latitude: 22.542449,</div><div class="line">        title: &quot;Window of the world&quot;</div><div class="line">      &#125;,&#123;</div><div class="line">        longitude: 113.995516,</div><div class="line">        latitude: 22.537642,</div><div class="line">        title: &quot;&quot;</div><div class="line">      &#125;]</div><div class="line">    &#125;;</div><div class="line">    this.timer = null;</div><div class="line">  &#125;</div><div class="line">  componentDidMount() &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  componentWillUnmount () &#123;</div><div class="line">    this.timer &amp;&amp; clearInterval(this.timer);</div><div class="line">  &#125;</div><div class="line">  getLocation = () =&gt; &#123;</div><div class="line">    this.timer = setInterval(</div><div class="line">      () =&gt; &#123;</div><div class="line">        Geolocation.getCurrentPosition()</div><div class="line">          .then(data =&gt; &#123;</div><div class="line">            console.log(JSON.stringify(data));</div><div class="line">            this.setState(&#123;</div><div class="line">              marker: &#123;</div><div class="line">                latitude: data.latitude,</div><div class="line">                longitude: data.longitude,</div><div class="line">                title: &apos;Your location&apos;</div><div class="line">              &#125;,</div><div class="line">              center: &#123;</div><div class="line">                latitude: data.latitude,</div><div class="line">                longitude: data.longitude,</div><div class="line">                rand: Math.random()</div><div class="line">              &#125;</div><div class="line">            &#125;);</div><div class="line">          &#125;)</div><div class="line">          .catch(e =&gt;&#123;</div><div class="line">            console.warn(e, &apos;error&apos;);</div><div class="line">          &#125;)</div><div class="line">      &#125;,</div><div class="line">      2000</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;MapView</div><div class="line">          trafficEnabled=&#123;this.state.trafficEnabled&#125;</div><div class="line">          baiduHeatMapEnabled=&#123;this.state.baiduHeatMapEnabled&#125;</div><div class="line">          zoom=&#123;this.state.zoom&#125;</div><div class="line">          mapType=&#123;this.state.mapType&#125;</div><div class="line">          center=&#123;this.state.center&#125;</div><div class="line">          marker=&#123;this.state.marker&#125;</div><div class="line">          markers=&#123;this.state.markers&#125;</div><div class="line">          style=&#123;styles.map&#125;</div><div class="line">          onMarkerClick=&#123;(e) =&gt; &#123;</div><div class="line">            console.warn(JSON.stringify(e));</div><div class="line">          &#125;&#125;</div><div class="line">          onMapClick=&#123;(e) =&gt; &#123;</div><div class="line">          &#125;&#125;</div><div class="line">        &gt;</div><div class="line">        &lt;/MapView&gt;</div><div class="line">        &lt;View style=&#123;styles.row&#125;&gt;</div><div class="line">          &lt;Button style=&#123;styles.btn&#125; onClick=&#123;this.getLocation&#125;&gt;获取位置信息&lt;/Button&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">  button: &#123;</div><div class="line">    margin: 20,</div><div class="line">  &#125;,</div><div class="line">  row: &#123;</div><div class="line">    flexDirection: &apos;row&apos;,</div><div class="line">    height: 40</div><div class="line">  &#125;,</div><div class="line">  container: &#123;</div><div class="line">    flex: 1,</div><div class="line">    justifyContent: &apos;flex-start&apos;,</div><div class="line">    alignItems: &apos;center&apos;,</div><div class="line">    backgroundColor: &apos;#F5FCFF&apos;,</div><div class="line">  &#125;,</div><div class="line">  map: &#123;</div><div class="line">    width: Dimensions.get(&apos;window&apos;).width,</div><div class="line">    height: Dimensions.get(&apos;window&apos;).height - 200,</div><div class="line">    marginBottom: 16</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">export default BaiduLocationTest;</div></pre></td></tr></table></figure>
</li>
</ul>
<img src="/2017/06/17/react-native-baidu-map-android/map.gif" width="300" title="百度地图">
<img src="/2017/06/17/react-native-baidu-map-android/location.png" width="500" title="位置信息">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/17/fetch-timeout-wrapper/" itemprop="url">
                  Fetch-Timeout-Wrapper
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-17T09:52:18+08:00" content="2017-06-17">
              2017-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在使用react-native进行开发时，用到网络请求的地方，如果服务端未启动或存在网络问题，会弹出Network request failed，想自己设置客户端超时时间及超时提示信息，在react-native问题列表和网上查找后，已确认react-native用的fetch没有直接提供timeout设置的。</p>
<p>在网上查到了使用ES6的promise封装fetch的方式，自己修改成如下timeout_fetch.js工具类，经过验证可以解决使用fetch时timeout的设置问题，将项目所有使用fetch的地方替换成使用timeout_fetch即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">config中配置了系统默认的请求超时时间，方便后期统一修改</div><div class="line">*/</div><div class="line">import &#123; default as config &#125; from &apos;../config/base&apos;;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @param &#123;Promise&#125; fetch_promise fetch请求返回的Promise</div><div class="line"> * @param &#123;number&#125; timeout 超时时间，单位为毫秒</div><div class="line"> * @return 返回Promise</div><div class="line"> */</div><div class="line">function promise_fetch(fetch_promise, timeout) &#123;</div><div class="line">  let timeout_fn = null;</div><div class="line">  // 这是一个可以被reject的promise</div><div class="line">  let timeout_promise = new Promise((resolve, reject) =&gt; &#123;</div><div class="line">    timeout_fn = () =&gt; &#123;</div><div class="line">      const error = new Error(&apos;网络请求超时&apos;);</div><div class="line">      reject(error);</div><div class="line">    &#125;;</div><div class="line">  &#125;);</div><div class="line">  /*</div><div class="line">  这里使用Promise.race，以先返回的 resolve 或 reject 的结果来传入后续绑定的回调。</div><div class="line">  timeout不是请求连接超时的含义，它表示请求的response时间，fetch的timeout即使超时发生了，本次请求也不会被abort丢弃掉，它在后台仍然会发送到服务器端，只是本次请求的响应内容被丢弃而已。</div><div class="line">  */</div><div class="line">  const abortable_promise = Promise.race([</div><div class="line">    fetch_promise,</div><div class="line">    timeout_promise</div><div class="line">  ]);</div><div class="line">  setTimeout(function() &#123;</div><div class="line">    timeout_fn();</div><div class="line">  &#125;, timeout);</div><div class="line">  return abortable_promise;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> * @param &#123;string&#125; url 请求地址</div><div class="line"> * @param &#123;object&#125; params 请求参数，其中timeout是超时设置，如果没有取全局配置的默认值</div><div class="line"> * @return 返回Promise</div><div class="line"> */</div><div class="line">export function timeout_fetch(url, params) &#123;</div><div class="line">  return new Promise((resolve, reject) =&gt; &#123;</div><div class="line">    promise_fetch(fetch(url, params), params.timeout ? params.timeout : config.clientTimeout * 1000)</div><div class="line">      .then((responseData) =&gt; &#123;</div><div class="line">          resolve(responseData);</div><div class="line">      &#125;)</div><div class="line">      .catch((err) =&gt; &#123;</div><div class="line">          reject(err);</div><div class="line">      &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
       
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小朱</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;

            $('.popup').detach().appendTo('.container');
            //$('.popup').detach().appendTo('.header-inner');

            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
